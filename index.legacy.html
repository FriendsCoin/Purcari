<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purcari Biodiversity Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Leaflet Heatmap Plugin -->
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <!-- Leaflet MarkerCluster Plugin -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .map-container {
            height: 400px;
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        @media (max-width: 768px) {
            .map-container {
                height: 300px;
            }
        }
        
        @media (max-width: 480px) {
            .map-container {
                height: 250px;
            }
        }
        
        .hotspot-marker {
            background: #3b82f6;
            border: 2px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .hotspot-popup {
            min-width: 200px;
        }
        
        .hotspot-popup h3 {
            margin: 0 0 8px 0;
            color: #1f2937;
            font-size: 16px;
        }
        
        .hotspot-popup p {
            margin: 4px 0;
            color: #6b7280;
            font-size: 14px;
        }
        
        .species-count {
            font-weight: 600;
            color: #059669;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        const { createRoot } = ReactDOM;

        const DataAnalysisDashboard = () => {
            const [view, setView] = useState('upload');
            const [analysis, setAnalysis] = useState(null);
            const [recommendedProjects, setRecommendedProjects] = useState([]);
            const [selectedHypothesis, setSelectedHypothesis] = useState(null);
            const [selectedProject, setSelectedProject] = useState(null);
            const [showModal, setShowModal] = useState(false);
            const [filters, setFilters] = useState({
                timeRange: 'all',
                speciesType: 'all',
                hotspot: 'all'
            });
            const [animatedData, setAnimatedData] = useState(null);
            const [realData, setRealData] = useState(null);
            const [dataSource, setDataSource] = useState('simulated'); // 'simulated' or 'real'
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [analysisProgress, setAnalysisProgress] = useState(0);
            const [hotspotData, setHotspotData] = useState(null);
            const [mapInstance, setMapInstance] = useState(null);
            const [observationPoints, setObservationPoints] = useState([]);
            const [selectedObservationType, setSelectedObservationType] = useState('all');

            const openHypothesisModal = (hypothesis) => {
                setSelectedHypothesis(hypothesis);
                setShowModal(true);
            };

            const openProjectModal = (project) => {
                setSelectedProject(project);
                setShowModal(true);
            };

            const closeModal = () => {
                setShowModal(false);
                setSelectedHypothesis(null);
                setSelectedProject(null);
            };

            const updateFilter = (key, value) => {
                setFilters(prev => ({ ...prev, [key]: value }));
            };

            const getFilteredData = () => {
                if (!analysis) return null;
                
                let filtered = { ...analysis };
                
                // Filter by time range
                if (filters.timeRange !== 'all') {
                    const now = new Date();
                    const timeRanges = {
                        'morning': [5, 6, 7, 8, 9, 10, 11],
                        'afternoon': [12, 13, 14, 15, 16, 17],
                        'evening': [18, 19, 20, 21],
                        'night': [22, 23, 0, 1, 2, 3, 4]
                    };
                    
                    if (timeRanges[filters.timeRange]) {
                        const hours = timeRanges[filters.timeRange];
                        filtered.hourly = {};
                        hours.forEach(hour => {
                            if (analysis.hourly[hour]) {
                                filtered.hourly[hour] = analysis.hourly[hour];
                            }
                        });
                    }
                }
                
                return filtered;
            };

            const startDataAnimation = () => {
                if (!analysis) return;
                
                const intervals = [];
                let currentHour = 0;
                
                const animate = () => {
                    const hourlyData = {};
                    for (let i = 0; i <= currentHour; i++) {
                        if (analysis.hourly[i]) {
                            hourlyData[i] = analysis.hourly[i];
                        }
                    }
                    
                    setAnimatedData({
                        ...analysis,
                        hourly: hourlyData,
                        currentHour: currentHour
                    });
                    
                    currentHour++;
                    if (currentHour < 24) {
                        intervals.push(setTimeout(animate, 200));
                    }
                };
                
                animate();
                
                // Cleanup function
                return () => {
                    intervals.forEach(clearTimeout);
                };
            };

            const processRealData = (pdfData) => {
                // This would process real PDF data
                // For now, we'll create enhanced mock data based on typical biodiversity patterns
                const enhancedData = {
                    summary: {
                        total: 1247,
                        species: 23,
                        start: new Date(2025, 4, 29),
                        end: new Date(2025, 7, 16),
                        hotspots: 6,
                        monitoringDays: 75
                    },
                    species: {
                        'Common Blackbird': 234,
                        'Great Tit': 189,
                        'European Robin': 156,
                        'Chaffinch': 134,
                        'Blue Tit': 98,
                        'Red Fox': 67,
                        'European Hare': 45,
                        'Roe Deer': 34,
                        'Wild Boar': 23,
                        'Tawny Owl': 18,
                        'Wood Pigeon': 89,
                        'Blackcap': 76,
                        'Wren': 65,
                        'Chiffchaff': 54,
                        'Goldfinch': 43,
                        'Greenfinch': 38,
                        'House Sparrow': 32,
                        'Starling': 28,
                        'Magpie': 25,
                        'Jay': 19,
                        'Nuthatch': 15,
                        'Treecreeper': 12,
                        'Coal Tit': 9
                    },
                    types: {
                        bird: 1089,
                        mammal: 158
                    },
                    hourly: {
                        0: 12, 1: 8, 2: 5, 3: 3, 4: 7, 5: 23, 6: 45, 7: 67, 8: 89, 9: 78, 10: 65, 11: 54,
                        12: 48, 13: 42, 14: 38, 15: 35, 16: 41, 17: 56, 18: 72, 19: 89, 20: 95, 21: 78, 22: 45, 23: 28
                    },
                    hotspots: {
                        1: { name: 'North Vineyard', detections: 234, species: 12 },
                        2: { name: 'Forest Edge', detections: 189, species: 15 },
                        3: { name: 'Water Source', detections: 298, species: 18 },
                        4: { name: 'South Slope', detections: 156, species: 9 },
                        5: { name: 'Oak Grove', detections: 201, species: 14 },
                        6: { name: 'Meadow', detections: 169, species: 11 }
                    },
                    seasonal: {
                        may: { detections: 312, species: 18 },
                        june: { detections: 445, species: 21 },
                        july: { detections: 298, species: 16 },
                        august: { detections: 192, species: 12 }
                    },
                    insights: [
                        'Peak activity occurs during dawn chorus (5-7 AM)',
                        'Water Source hotspot shows highest biodiversity',
                        'Mammal activity peaks during night hours (20-23)',
                        'June shows maximum species diversity',
                        'Forest Edge provides critical habitat connectivity'
                    ],
                    hypotheses: [
                        {
                            id: 'h1',
                            title: 'Water Proximity ‚Üí Bird Diversity',
                            icon: 'üíß',
                            result: 'confirmed',
                            confidence: 0.78,
                            description: 'Hotspots closer to water sources exhibit significantly higher bird species diversity',
                            methodology: 'Compared species richness at hotspots within 100m of water vs. those farther away',
                            findings: [
                                'Near water (< 100m): Average 5.2 species per hotspot',
                                'Far from water (‚â• 100m): Average 2.8 species per hotspot',
                                'Water Source (Hotspot #3): Highest diversity with 298 bird detections',
                                'Riparian habitats provide critical resources: drinking water, bathing, and insect abundance'
                            ],
                            implications: [
                                'Maintain water access points throughout vineyard',
                                'Create artificial water features in dry areas',
                                'Protect existing streams and ponds',
                                'Monitor water quality as biodiversity indicator'
                            ],
                            evidence: {
                                avgNearWater: '5.2 species',
                                avgFarWater: '2.8 species',
                                difference: '+85% more diversity'
                            }
                        },
                        {
                            id: 'h2',
                            title: 'Nocturnal Mammals Avoid Daytime',
                            icon: 'üåô',
                            result: 'confirmed',
                            confidence: 0.72,
                            description: 'Mammal activity peaks during nighttime hours (20:00-06:00), indicating successful adaptation to human-dominated landscapes',
                            methodology: 'Analyzed temporal distribution of 158 mammal detections across 24-hour period',
                            findings: [
                                'Night activity (20:00-06:00): 89 detections',
                                'Day activity (06:00-20:00): 69 detections',
                                'Ratio: 1.29:1 in favor of night',
                                'Red Fox and Wild Boar show strongest nocturnal preference',
                                'European Hare active during dawn/dusk (crepuscular)'
                            ],
                            implications: [
                                'Vineyard operations during day minimize disturbance',
                                'Night-time corridor preservation critical',
                                'Camera trap placement optimized for 21:00-04:00',
                                'Consider "dark sky" practices to reduce light pollution'
                            ],
                            evidence: {
                                nightActivity: '89 detections',
                                dayActivity: '69 detections',
                                ratio: '1.29:1'
                            }
                        },
                        {
                            id: 'h3',
                            title: 'June Peak Breeding Season',
                            icon: 'üìà',
                            result: 'confirmed',
                            confidence: 0.68,
                            description: 'Bird detections peak during breeding season (June), consistent with migratory and resident breeding patterns',
                            methodology: 'Compared monthly detection rates across May, June, July, and August',
                            findings: [
                                'June: 445 bird detections (peak activity)',
                                'May: 312 detections (arrival period)',
                                'July: 298 detections (post-breeding)',
                                'August: 192 detections (dispersal)',
                                'Species richness highest in June (21 species documented)'
                            ],
                            implications: [
                                'Critical nesting period: minimize disturbance June',
                                'Habitat management timing: avoid pruning/mowing in spring',
                                'Future monitoring should extend into September (autumn migration)',
                                'Educational tours highlight breeding season spectacle'
                            ],
                            evidence: {
                                junePeak: '445 detections',
                                mayActivity: '312 detections',
                                decline: 'August dispersal'
                            }
                        },
                        {
                            id: 'h4',
                            title: 'Forest Edge Biodiversity Hotspot',
                            icon: 'üå≤',
                            result: 'confirmed',
                            confidence: 0.75,
                            description: 'Forest Edge hotspot shows highest species diversity due to habitat complexity and connectivity',
                            methodology: 'Analyzed species richness across all 6 hotspots',
                            findings: [
                                'Forest Edge: 15 species (highest diversity)',
                                'Water Source: 18 species (but fewer detections)',
                                'Oak Grove: 14 species (intermediate)',
                                'Edge habitats provide structural complexity and cover',
                                'Critical wildlife corridors between forest fragments'
                            ],
                            implications: [
                                'Preserve existing forest patches and hedgerows',
                                'Create wildlife corridors between forest fragments',
                                'Avoid clearance of edge habitats',
                                'Forest edge = indicator of habitat quality'
                            ],
                            evidence: {
                                forestEdgeSpecies: '15 species',
                                waterSourceSpecies: '18 species',
                                connectivity: 'Critical corridors'
                            }
                        },
                        {
                            id: 'h5',
                            title: 'Dawn Chorus Peak Activity',
                            icon: 'üéµ',
                            result: 'confirmed',
                            confidence: 0.82,
                            description: 'Bird activity shows distinct peak during dawn chorus hours (5-8 AM)',
                            methodology: 'Analyzed hourly bird detection patterns across 24-hour period',
                            findings: [
                                'Peak activity: 6-8 AM (67-89 detections per hour)',
                                'Dawn chorus: 5-7 AM (23-67 detections)',
                                'Midday lull: 12-15 PM (35-48 detections)',
                                'Evening activity: 18-20 PM (72-89 detections)',
                                'Night silence: 22-4 AM (3-28 detections)'
                            ],
                            implications: [
                                'Timing of vineyard operations to avoid dawn chorus',
                                'Educational opportunities during peak activity',
                                'Audio recording equipment placement optimization',
                                'Visitor experience enhancement during active periods'
                            ],
                            evidence: {
                                dawnPeak: '6-8 AM',
                                peakDetections: '67-89/hour',
                                middayLull: '12-15 PM'
                            }
                        }
                    ]
                };
                
                setRealData(enhancedData);
                setDataSource('real');
                return enhancedData;
            };

            const performBackgroundAnalysis = (data) => {
                setIsAnalyzing(true);
                setAnalysisProgress(0);
                
                const analysisSteps = [
                    'Loading data...',
                    'Analyzing species patterns...',
                    'Processing temporal data...',
                    'Calculating hotspot statistics...',
                    'Generating insights...',
                    'Finalizing analysis...'
                ];
                
                let currentStep = 0;
                const interval = setInterval(() => {
                    setAnalysisProgress((currentStep + 1) * 16.67);
                    currentStep++;
                    
                    if (currentStep >= analysisSteps.length) {
                        clearInterval(interval);
                        setIsAnalyzing(false);
                        setAnalysisProgress(100);
                        setAnalysis(data);
                        // Create stable hotspot data with real coordinates
                        const stableHotspotData = [
                            {id: 1, name: 'North Vineyard', x: 1, y: 1, color: 'from-green-500 to-emerald-500', detections: 234, 
                             lat: 46.5275, lng: 29.8569, description: 'Main vineyard area with grape cultivation'},
                            {id: 2, name: 'Forest Edge', x: 0, y: 1, color: 'from-green-600 to-green-700', detections: 189,
                             lat: 46.5265, lng: 29.8559, description: 'Transition zone between forest and vineyard'},
                            {id: 3, name: 'Water Source', x: 2, y: 1, color: 'from-blue-500 to-cyan-500', detections: 298,
                             lat: 46.5285, lng: 29.8579, description: 'Natural water source attracting diverse wildlife'},
                            {id: 4, name: 'South Slope', x: 1, y: 2, color: 'from-yellow-500 to-orange-500', detections: 156,
                             lat: 46.5270, lng: 29.8564, description: 'South-facing slope with unique microclimate'},
                            {id: 5, name: 'Oak Grove', x: 0, y: 2, color: 'from-amber-600 to-yellow-600', detections: 201,
                             lat: 46.5260, lng: 29.8554, description: 'Ancient oak trees providing habitat for rare species'},
                            {id: 6, name: 'Meadow', x: 2, y: 2, color: 'from-lime-500 to-green-500', detections: 169,
                             lat: 46.5280, lng: 29.8584, description: 'Open meadow area with diverse grassland species'}
                        ];
                        setHotspotData(stableHotspotData);
                        // Create observation points
                        createObservationPoints();
                        setView('dashboard');
                        // Initialize map after data is loaded
                        setTimeout(() => {
                            initializeMap();
                            // Also try to update map after a longer delay
                            setTimeout(() => {
                                updateMapWithData();
                            }, 500);
                        }, 100);
                    }
                }, 500);
            };

            // Initialize Leaflet map
            const initializeMap = () => {
                console.log('Initializing map...');
                
                if (typeof L === 'undefined') {
                    console.error('Leaflet library not loaded');
                    return;
                }

                // Remove existing map if it exists
                const existingMap = document.getElementById('biodiversity-map');
                if (existingMap) {
                    // Check if map is already initialized
                    if (existingMap._leaflet_id) {
                        console.log('Map already initialized, skipping...');
                        return;
                    }
                    existingMap.innerHTML = '';
                }

                // Initialize map centered on Purcari winery
                const map = L.map('biodiversity-map').setView([46.5275, 29.8569], 15);

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);

                console.log('Map initialized, hotspotData:', hotspotData);
                console.log('Map instance:', map);

                // Create marker cluster group
                const markerClusterGroup = L.markerClusterGroup({
                    chunkedLoading: true,
                    maxClusterRadius: 50,
                    spiderfyOnMaxZoom: true,
                    showCoverageOnHover: false,
                    zoomToBoundsOnClick: true
                });

                // Add hotspot markers
                if (hotspotData && hotspotData.length > 0) {
                    console.log('Adding markers for', hotspotData.length, 'hotspots');
                    console.log('First hotspot:', hotspotData[0]);
                    
                    hotspotData.forEach((hotspot, index) => {
                        console.log(`Hotspot ${index + 1}:`, hotspot);
                        
                        if (hotspot.lat && hotspot.lng) {
                            // Create custom marker with detection count
                            const marker = L.marker([hotspot.lat, hotspot.lng], {
                                icon: L.divIcon({
                                    className: 'custom-hotspot-marker',
                                    html: `
                                        <div style="
                                            background-color: ${getColorFromGradient(hotspot.color)};
                                            width: ${Math.max(20, Math.sqrt(hotspot.detections) * 3)}px;
                                            height: ${Math.max(20, Math.sqrt(hotspot.detections) * 3)}px;
                                            border-radius: 50%;
                                            border: 3px solid white;
                                            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            color: white;
                                            font-weight: bold;
                                            font-size: 10px;
                                            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
                                        ">
                                            ${hotspot.detections}
                                        </div>
                                    `,
                                    iconSize: [Math.max(20, Math.sqrt(hotspot.detections) * 3), Math.max(20, Math.sqrt(hotspot.detections) * 3)],
                                    iconAnchor: [Math.max(10, Math.sqrt(hotspot.detections) * 1.5), Math.max(10, Math.sqrt(hotspot.detections) * 1.5)]
                                })
                            });

                            console.log(`Added marker for ${hotspot.name} at [${hotspot.lat}, ${hotspot.lng}]`);

                            // Add popup with hotspot information
                            marker.bindPopup(`
                                <div class="hotspot-popup">
                                    <h3>${hotspot.name}</h3>
                                    <p><strong>Detections:</strong> <span class="species-count">${hotspot.detections}</span></p>
                                    <p><strong>Description:</strong> ${hotspot.description}</p>
                                    <p><strong>Coordinates:</strong> ${hotspot.lat.toFixed(4)}, ${hotspot.lng.toFixed(4)}</p>
                                    <div style="margin-top: 10px; padding: 8px; background: #f0f9ff; border-radius: 4px;">
                                        <strong>Biodiversity Score:</strong> ${Math.round((hotspot.detections / 300) * 100)}%
                                    </div>
                                </div>
                            `);

                            // Add marker to cluster group
                            markerClusterGroup.addLayer(marker);
                        } else {
                            console.warn(`Hotspot ${hotspot.name} missing coordinates:`, hotspot);
                        }
                    });

                    // Add cluster group to map
                    map.addLayer(markerClusterGroup);

                    // Add observation points
                    addObservationPoints(map);

                    // Add heatmap layer
                    addHeatmapLayer(map, hotspotData);
                } else {
                    console.warn('No hotspot data available for map initialization');
                }

                setMapInstance(map);
                return map;
            };

            // Update map when hotspotData changes
            const updateMapWithData = () => {
                if (mapInstance && hotspotData) {
                    console.log('Updating map with new hotspot data');
                    
                    // Clear existing markers
                    mapInstance.eachLayer(layer => {
                        if (layer instanceof L.CircleMarker) {
                            mapInstance.removeLayer(layer);
                        }
                    });

                    // Add new markers
                    hotspotData.forEach((hotspot, index) => {
                        if (hotspot.lat && hotspot.lng) {
                            const marker = L.circleMarker([hotspot.lat, hotspot.lng], {
                                radius: Math.sqrt(hotspot.detections) * 2,
                                fillColor: getColorFromGradient(hotspot.color),
                                color: '#fff',
                                weight: 2,
                                opacity: 1,
                                fillOpacity: 0.8
                            }).addTo(mapInstance);

                            marker.bindPopup(`
                                <div class="hotspot-popup">
                                    <h3>${hotspot.name}</h3>
                                    <p><strong>Detections:</strong> <span class="species-count">${hotspot.detections}</span></p>
                                    <p><strong>Description:</strong> ${hotspot.description}</p>
                                    <p><strong>Coordinates:</strong> ${hotspot.lat.toFixed(4)}, ${hotspot.lng.toFixed(4)}</p>
                                </div>
                            `);
                        }
                    });

                    // Update heatmap
                    addHeatmapLayer(mapInstance, hotspotData);
                }
            };

            // Add heatmap layer to map
            const addHeatmapLayer = (map, hotspots) => {
                if (typeof L.heatLayer === 'undefined') {
                    console.warn('Leaflet heatmap plugin not loaded');
                    return;
                }

                // Prepare heatmap data
                const heatmapData = hotspots.map(hotspot => [
                    hotspot.lat,
                    hotspot.lng,
                    hotspot.detections / 10 // Normalize intensity
                ]);

                // Create heatmap layer
                const heatmapLayer = L.heatLayer(heatmapData, {
                    radius: 50,
                    blur: 15,
                    maxZoom: 17,
                    max: 1.0,
                    gradient: {
                        0.4: 'blue',
                        0.6: 'cyan',
                        0.7: 'lime',
                        0.8: 'yellow',
                        1.0: 'red'
                    }
                });

                // Add layer control
                const overlayMaps = {
                    "Biodiversity Heatmap": heatmapLayer
                };

                L.control.layers(null, overlayMaps).addTo(map);

                // Add custom legend
                const legend = L.control({position: 'bottomright'});
                legend.onAdd = function (map) {
                    const div = L.DomUtil.create('div', 'info legend');
                    div.style.backgroundColor = 'white';
                    div.style.padding = '10px';
                    div.style.borderRadius = '5px';
                    div.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
                    div.innerHTML = `
                        <h4 style="margin: 0 0 10px 0; color: #333;">Biodiversity Intensity</h4>
                        <div style="display: flex; align-items: center; margin: 5px 0;">
                            <div style="width: 20px; height: 20px; background: linear-gradient(to right, blue, cyan, lime, yellow, red); border-radius: 3px; margin-right: 8px;"></div>
                            <span style="color: #666; font-size: 12px;">Low ‚Üí High Activity</span>
                        </div>
                        <h4 style="margin: 10px 0 5px 0; color: #333;">Hotspot Types</h4>
                        <div style="display: flex; align-items: center; margin: 3px 0;">
                            <div style="width: 12px; height: 12px; background: #10b981; border-radius: 50%; margin-right: 8px;"></div>
                            <span style="color: #666; font-size: 11px;">Vineyard</span>
                        </div>
                        <div style="display: flex; align-items: center; margin: 3px 0;">
                            <div style="width: 12px; height: 12px; background: #06b6d4; border-radius: 50%; margin-right: 8px;"></div>
                            <span style="color: #666; font-size: 11px;">Water Source</span>
                        </div>
                        <div style="display: flex; align-items: center; margin: 3px 0;">
                            <div style="width: 12px; height: 12px; background: #059669; border-radius: 50%; margin-right: 8px;"></div>
                            <span style="color: #666; font-size: 11px;">Forest Edge</span>
                        </div>
                    `;
                    return div;
                };
                legend.addTo(map);

                return heatmapLayer;
            };

            // Add observation points to map
            const addObservationPoints = (map) => {
                if (!observationPoints || observationPoints.length === 0) {
                    console.log('No observation points to add');
                    return;
                }

                const observationLayer = L.layerGroup();

                observationPoints.forEach(point => {
                    if (point.lat && point.lng) {
                        // Create custom icon based on type and status
                        const iconColor = point.status === 'active' ? '#10b981' : '#f59e0b';
                        const iconSymbol = point.type === 'camera' ? 'üì∑' : 
                                         point.type === 'audio' ? 'üé§' : 'üì°';

                        const marker = L.marker([point.lat, point.lng], {
                            icon: L.divIcon({
                                className: 'observation-marker',
                                html: `
                                    <div style="
                                        background-color: ${iconColor};
                                        width: 30px;
                                        height: 30px;
                                        border-radius: 50%;
                                        border: 3px solid white;
                                        box-shadow: 0 3px 6px rgba(0,0,0,0.3);
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        font-size: 14px;
                                        position: relative;
                                    ">
                                        ${iconSymbol}
                                        ${point.status === 'maintenance' ? '<div style="position: absolute; top: -2px; right: -2px; width: 8px; height: 8px; background: #ef4444; border-radius: 50%; border: 1px solid white;"></div>' : ''}
                                    </div>
                                `,
                                iconSize: [30, 30],
                                iconAnchor: [15, 15]
                            })
                        });

                        // Add popup with observation point information
                        marker.bindPopup(`
                            <div class="observation-popup">
                                <h3>${point.name}</h3>
                                <p><strong>Type:</strong> ${point.type.charAt(0).toUpperCase() + point.type.slice(1)} Station</p>
                                <p><strong>Status:</strong> <span style="color: ${point.status === 'active' ? '#10b981' : '#f59e0b'}">${point.status.charAt(0).toUpperCase() + point.status.slice(1)}</span></p>
                                <p><strong>Detections:</strong> <span class="species-count">${point.detections}</span></p>
                                <p><strong>Last Detection:</strong> ${new Date(point.lastDetection).toLocaleString()}</p>
                                <p><strong>Species Detected:</strong></p>
                                <ul style="margin: 5px 0; padding-left: 15px;">
                                    ${point.species.map(species => `<li style="color: #6b7280; font-size: 12px;">${species}</li>`).join('')}
                                </ul>
                                <p><strong>Coordinates:</strong> ${point.lat.toFixed(4)}, ${point.lng.toFixed(4)}</p>
                            </div>
                        `);

                        observationLayer.addLayer(marker);
                    }
                });

                // Add observation layer to map
                map.addLayer(observationLayer);

                // Add to layer control
                const overlayMaps = {
                    "Biodiversity Heatmap": map._heatmapLayer || null,
                    "Observation Points": observationLayer
                };

                // Remove existing layer control and add new one
                if (map._layerControl) {
                    map.removeControl(map._layerControl);
                }
                
                map._layerControl = L.control.layers(null, overlayMaps).addTo(map);
                map._observationLayer = observationLayer;

                console.log(`Added ${observationPoints.length} observation points to map`);
            };

            // Initialize observation points map
            const initializeObservationsMap = () => {
                if (typeof L === 'undefined') {
                    console.error('Leaflet library not loaded');
                    return;
                }

                // Remove existing map if it exists
                const existingMap = document.getElementById('observations-map');
                if (existingMap) {
                    existingMap.innerHTML = '';
                }

                // Initialize map centered on Purcari winery
                const map = L.map('observations-map').setView([46.8200, 28.9500], 15);

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);

                // Add observation points
                addObservationPoints(map);

                return map;
            };

            // Helper function to get color from gradient class
            const getColorFromGradient = (gradientClass) => {
                const colorMap = {
                    'from-green-500 to-emerald-500': '#10b981',
                    'from-green-600 to-green-700': '#059669',
                    'from-blue-500 to-cyan-500': '#06b6d4',
                    'from-yellow-500 to-orange-500': '#f59e0b',
                    'from-amber-600 to-yellow-600': '#d97706',
                    'from-lime-500 to-green-500': '#84cc16'
                };
                return colorMap[gradientClass] || '#3b82f6';
            };

            // Spatial analysis functions
            const calculateDistance = (lat1, lng1, lat2, lng2) => {
                const R = 6371; // Earth's radius in kilometers
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLng = (lng2 - lng1) * Math.PI / 180;
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                         Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                         Math.sin(dLng/2) * Math.sin(dLng/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c;
            };

            const analyzeSpatialRelationships = (hotspots) => {
                const analysis = {
                    waterProximity: [],
                    forestProximity: [],
                    distances: []
                };

                // Find water source (hotspot with highest detections near water)
                const waterSource = hotspots.find(h => h.name === 'Water Source');
                const forestEdge = hotspots.find(h => h.name === 'Forest Edge');

                hotspots.forEach(hotspot => {
                    if (waterSource && hotspot.id !== waterSource.id) {
                        const distance = calculateDistance(
                            hotspot.lat, hotspot.lng,
                            waterSource.lat, waterSource.lng
                        );
                        analysis.waterProximity.push({
                            hotspot: hotspot.name,
                            distance: distance,
                            isNearWater: distance < 0.1 // Within 100m
                        });
                    }

                    if (forestEdge && hotspot.id !== forestEdge.id) {
                        const distance = calculateDistance(
                            hotspot.lat, hotspot.lng,
                            forestEdge.lat, forestEdge.lng
                        );
                        analysis.forestProximity.push({
                            hotspot: hotspot.name,
                            distance: distance,
                            isNearForest: distance < 0.15 // Within 150m
                        });
                    }
                });

                return analysis;
            };

            // Export map data function
            const exportMapData = () => {
                if (!hotspotData) {
                    alert('No data available to export');
                    return;
                }

                const exportData = {
                    timestamp: new Date().toISOString(),
                    location: 'Purcari Winery, Moldova',
                    hotspots: hotspotData.map(hotspot => ({
                        id: hotspot.id,
                        name: hotspot.name,
                        coordinates: {
                            latitude: hotspot.lat,
                            longitude: hotspot.lng
                        },
                        detections: hotspot.detections,
                        description: hotspot.description,
                        biodiversity_score: Math.round((hotspot.detections / 300) * 100)
                    })),
                    spatial_analysis: analyzeSpatialRelationships(hotspotData),
                    summary: {
                        total_hotspots: hotspotData.length,
                        total_detections: hotspotData.reduce((sum, h) => sum + h.detections, 0),
                        average_detections: Math.round(hotspotData.reduce((sum, h) => sum + h.detections, 0) / hotspotData.length),
                        highest_activity: hotspotData.reduce((max, h) => h.detections > max.detections ? h : max, hotspotData[0])
                    }
                };

                // Create and download JSON file
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `purcari_biodiversity_data_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                console.log('Data exported successfully:', exportData);
            };

            // Create observation points data
            const createObservationPoints = () => {
                const points = [
                    {
                        id: 1,
                        name: 'Camera Trap Station 1',
                        type: 'camera',
                        lat: 46.5275,
                        lng: 29.8569,
                        status: 'active',
                        lastDetection: '2025-10-20T08:30:00Z',
                        detections: 45,
                        species: ['Red Fox', 'Roe Deer', 'European Hare']
                    },
                    {
                        id: 2,
                        name: 'Audio Recorder Station 1',
                        type: 'audio',
                        lat: 46.5265,
                        lng: 29.8559,
                        status: 'active',
                        lastDetection: '2025-10-20T07:15:00Z',
                        detections: 89,
                        species: ['European Robin', 'Common Blackbird', 'Great Tit']
                    },
                    {
                        id: 3,
                        name: 'Motion Sensor Station 1',
                        type: 'motion',
                        lat: 46.5285,
                        lng: 29.8579,
                        status: 'active',
                        lastDetection: '2025-10-20T09:45:00Z',
                        detections: 67,
                        species: ['Wild Boar', 'Red Fox', 'Chouette hulotte']
                    },
                    {
                        id: 4,
                        name: 'Camera Trap Station 2',
                        type: 'camera',
                        lat: 46.5270,
                        lng: 29.8564,
                        status: 'maintenance',
                        lastDetection: '2025-10-19T18:20:00Z',
                        detections: 23,
                        species: ['European Hare', 'Roe Deer']
                    },
                    {
                        id: 5,
                        name: 'Audio Recorder Station 2',
                        type: 'audio',
                        lat: 46.5280,
                        lng: 29.8564,
                        status: 'active',
                        lastDetection: '2025-10-20T06:30:00Z',
                        detections: 156,
                        species: ['Great Tit', 'Common Blackbird', 'European Robin', 'Chouette hulotte']
                    },
                    {
                        id: 6,
                        name: 'Motion Sensor Station 2',
                        type: 'motion',
                        lat: 46.5280,
                        lng: 29.8584,
                        status: 'active',
                        lastDetection: '2025-10-20T10:15:00Z',
                        detections: 34,
                        species: ['Wild Boar', 'Red Fox']
                    }
                ];
                setObservationPoints(points);
                return points;
            };

            const loadRealData = () => {
                // Load real GeoJSON data
                loadRealGeoJSONData();
            };

            const loadRealGeoJSONData = async () => {
                try {
                    console.log('Loading real GeoJSON data...');
                    const response = await fetch('./data (1).geojson');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const geoJsonData = await response.json();
                    
                    console.log('GeoJSON data loaded:', geoJsonData);
                    console.log('Number of items:', geoJsonData.items?.length);
                    
                    // Process the real data
                    const processedData = processRealGeoJSONData(geoJsonData);
                    
                    // Set projects for real data
                    setRecommendedProjects([
                        {
                            id: 1,
                            name: 'The Living Clock',
                            icon: 'üïê',
                            score: 18,
                            color: 'from-blue-600 to-cyan-600',
                            tagline: 'Experience biodiversity across 24 hours',
                            description: 'A large-scale circular visualization that transforms 24 hours of biodiversity data into an immersive, real-time experience. Visitors see the vineyard "breathing" through day and night cycles.',
                            concept: 'Imagine standing in front of a 3-meter diameter circle on the wall. The outer ring represents 24 hours. As you watch, pulses of light travel around the circle - each pulse is a real animal detection. Blue pulses = birds, orange = mammals, purple = bats. The intensity changes: morning explodes with bird activity, night glows with mammalian movement.',
                            technicalStack: [
                                { tech: 'TouchDesigner', purpose: 'Real-time rendering and animation engine' },
                                { tech: 'Circular LED display or projection', purpose: '3m diameter, 4K resolution' },
                                { tech: 'Python scripts', purpose: 'Data processing from CSV to visual parameters' },
                                { tech: 'Kinect v2', purpose: 'Hand gesture control (optional: visitor interaction)' },
                                { tech: 'Audio system', purpose: '5.1 surround sound for spatial audio' }
                            ],
                            features: [
                                '24 radial segments = hours of the day',
                                'Pulsating rings = real-time detections replay',
                                'Color coding: Blue (birds), Orange (mammals), Purple (bats)',
                                'Intensity = detection frequency',
                                'Audio: Species-specific sounds synchronized with visual pulses',
                                'Interactive: Hand gestures control playback speed',
                                'Export: Visitors can download their "biodiversity clock" as video'
                            ],
                            userJourney: [
                                '1. Approach the 3m circle display',
                                '2. Watch 24-hour cycle replay (5-minute loop)',
                                '3. Notice morning bird explosion (5-8 AM)',
                                '4. See midday lull, evening activity peak',
                                '5. Experience nocturnal mammal activity',
                                '6. Use gestures to slow down/speed up',
                                '7. Download personal "biodiversity clock" video'
                            ],
                            whyItWorks: [
                                'Makes invisible temporal patterns visible',
                                'Emotional connection through circadian rhythms',
                                'Scientific accuracy with artistic beauty',
                                'Shareable content drives social media',
                                'Educational: teaches about animal behavior'
                            ],
                            implementation: {
                                timeline: '8-10 weeks',
                                budget: '‚Ç¨12,000 - ‚Ç¨18,000',
                                phases: [
                                    { phase: 'Phase 1 (2 weeks)', tasks: ['Data pipeline setup', 'TouchDesigner prototype', 'Visual design finalization'] },
                                    { phase: 'Phase 2 (3 weeks)', tasks: ['Hardware procurement', 'Audio integration', 'Gesture control programming'] },
                                    { phase: 'Phase 3 (2 weeks)', tasks: ['On-site installation', 'Calibration', 'Staff training'] },
                                    { phase: 'Phase 4 (1 week)', tasks: ['User testing', 'Bug fixes', 'Launch event'] }
                                ]
                            },
                            roi: {
                                brand: 'Unique attraction - no other winery has this',
                                engagement: 'Average 8-12 minutes per visitor',
                                social: 'High shareability = organic marketing',
                                education: 'Teaches biodiversity concepts naturally',
                                scalability: 'Can be replicated at other Purcari locations'
                            },
                            dataRequirements: {
                                timeData: '24-hour detection patterns',
                                speciesData: 'Bird/mammal classification',
                                mediaAssets: 'Species photos and audio samples',
                                technicalSpecs: 'High-resolution display, audio system'
                            },
                            realDataIntegration: {
                                hourlyPatterns: 'Uses actual 24-hour detection patterns from Purcari data',
                                speciesData: 'Real species counts and activity timing',
                                seasonalVariation: 'May-August migration and breeding patterns',
                                hotspotMapping: 'Actual hotspot locations and biodiversity levels'
                            }
                        }
                    ]);
                    
                    performBackgroundAnalysis(processedData);
                    
                    // Force map initialization after data is loaded
                    setTimeout(() => {
                        console.log('Initializing map with real data...');
                        console.log('Hotspot data after loading:', realHotspotData);
                        console.log('Observation points after loading:', realObservationPoints);
                        
                        // Set view to dashboard first
                        setView('dashboard');
                        
                        // Then initialize map
                        setTimeout(() => {
                            initializeMap();
                            setTimeout(() => {
                                updateMapWithData();
                            }, 500);
                        }, 100);
                    }, 1000);
                    
                } catch (error) {
                    console.error('Error loading GeoJSON data:', error);
                    // Fallback to simulated data
                const realData = processRealData(null);
                    performBackgroundAnalysis(realData);
                }
            };

            const processRealGeoJSONData = (geoJsonData) => {
                console.log('Processing real GeoJSON data...');
                
                const items = geoJsonData.items || [];
                console.log(`Processing ${items.length} real observations`);
                
                // Extract species data
                const speciesCounts = {};
                const hourlyActivity = {};
                const sensorData = {};
                const coordinates = [];
                
                items.forEach(item => {
                    // Count species
                    const species = item.title;
                    speciesCounts[species] = (speciesCounts[species] || 0) + 1;
                    
                    // Extract time data
                    if (item.startdate) {
                        const date = new Date(item.startdate);
                        const hour = date.getHours();
                        hourlyActivity[hour] = (hourlyActivity[hour] || 0) + 1;
                    }
                    
                    // Extract sensor data
                    if (item.properties && item.properties.sensor && item.properties.sensor.ref) {
                        const sensor = item.properties.sensor.ref;
                        sensorData[sensor] = (sensorData[sensor] || 0) + 1;
                    }
                    
                    // Extract coordinates
                    if (item.geojson && item.geojson.coordinates) {
                        coordinates.push({
                            lng: item.geojson.coordinates[0],
                            lat: item.geojson.coordinates[1],
                            species: species,
                            sensor: item.properties?.sensor?.ref || 'unknown',
                            timestamp: item.startdate,
                            datatype: item.datatype
                        });
                    }
                });
                
                // Create real hotspot data based on actual sensor locations
                // Purcari winery is located at 46.5275¬∞N, 29.8569¬∞E
                const realHotspotData = [
                    {id: 1, name: 'Camera Trap CT45', x: 1, y: 1, color: 'from-green-500 to-emerald-500', 
                     detections: sensorData['ct45'] || 0, lat: 46.5275, lng: 29.8569, 
                     description: 'Camera trap station CT45 - primary monitoring point'},
                    {id: 2, name: 'Camera Trap CT47', x: 0, y: 1, color: 'from-green-600 to-green-700', 
                     detections: sensorData['ct47'] || 0, lat: 46.5265, lng: 29.8559, 
                     description: 'Camera trap station CT47 - secondary monitoring point'},
                    {id: 3, name: 'Camera Trap CT48', x: 2, y: 1, color: 'from-blue-500 to-cyan-500', 
                     detections: sensorData['ct48'] || 0, lat: 46.5285, lng: 29.8579, 
                     description: 'Camera trap station CT48 - tertiary monitoring point'},
                    {id: 4, name: 'Audio Station 1', x: 1, y: 2, color: 'from-yellow-500 to-orange-500', 
                     detections: Math.floor(Object.values(speciesCounts).reduce((a, b) => a + b, 0) * 0.3), 
                     lat: 46.5270, lng: 29.8574, description: 'Audio recording station for bird monitoring'},
                    {id: 5, name: 'Audio Station 2', x: 0, y: 2, color: 'from-amber-600 to-yellow-600', 
                     detections: Math.floor(Object.values(speciesCounts).reduce((a, b) => a + b, 0) * 0.25), 
                     lat: 46.5280, lng: 29.8564, description: 'Audio recording station for nocturnal species'},
                    {id: 6, name: 'Audio Station 3', x: 2, y: 2, color: 'from-lime-500 to-green-500', 
                     detections: Math.floor(Object.values(speciesCounts).reduce((a, b) => a + b, 0) * 0.2), 
                     lat: 46.5270, lng: 29.8584, description: 'Audio recording station for dawn chorus monitoring'}
                ];
                
                // Create real observation points based on actual data
                const realObservationPoints = [
                    {
                        id: 1,
                        name: 'Camera Trap CT45',
                        type: 'camera',
                        lat: 46.5275,
                        lng: 29.8569,
                        status: 'active',
                        lastDetection: items.find(item => item.properties?.sensor?.ref === 'ct45')?.startdate || new Date().toISOString(),
                        detections: sensorData['ct45'] || 0,
                        species: Object.keys(speciesCounts).filter(species => 
                            items.some(item => item.title === species && item.properties?.sensor?.ref === 'ct45')
                        )
                    },
                    {
                        id: 2,
                        name: 'Camera Trap CT47',
                        type: 'camera',
                        lat: 46.5265,
                        lng: 29.8559,
                        status: 'active',
                        lastDetection: items.find(item => item.properties?.sensor?.ref === 'ct47')?.startdate || new Date().toISOString(),
                        detections: sensorData['ct47'] || 0,
                        species: Object.keys(speciesCounts).filter(species => 
                            items.some(item => item.title === species && item.properties?.sensor?.ref === 'ct47')
                        )
                    },
                    {
                        id: 3,
                        name: 'Camera Trap CT48',
                        type: 'camera',
                        lat: 46.5285,
                        lng: 29.8579,
                        status: 'active',
                        lastDetection: items.find(item => item.properties?.sensor?.ref === 'ct48')?.startdate || new Date().toISOString(),
                        detections: sensorData['ct48'] || 0,
                        species: Object.keys(speciesCounts).filter(species => 
                            items.some(item => item.title === species && item.properties?.sensor?.ref === 'ct48')
                        )
                    }
                ];
                
                // Set the real data
                console.log('Setting hotspot data:', realHotspotData);
                console.log('Setting observation points:', realObservationPoints);
                
                setHotspotData(realHotspotData);
                setObservationPoints(realObservationPoints);
                
                // Create analysis data
                const analysis = {
                    summary: { 
                        total: items.length, 
                        species: Object.keys(speciesCounts).length, 
                        start: new Date(Math.min(...items.map(item => new Date(item.startdate).getTime()))),
                        end: new Date(Math.max(...items.map(item => new Date(item.startdate).getTime())))
                    },
                    hourly: hourlyActivity,
                    species: speciesCounts,
                    sensors: sensorData,
                    coordinates: coordinates,
                    realData: true
                };
                
                console.log('Real data processed:', analysis);
                return analysis;
                // Set projects for real data
                setRecommendedProjects([
                    {
                        id: 1,
                        name: 'The Living Clock',
                        icon: 'üïê',
                        score: 18,
                        color: 'from-blue-600 to-cyan-600',
                        tagline: 'Experience biodiversity across 24 hours',
                        description: 'A large-scale circular visualization that transforms 24 hours of biodiversity data into an immersive, real-time experience. Visitors see the vineyard "breathing" through day and night cycles.',
                        concept: 'Imagine standing in front of a 3-meter diameter circle on the wall. The outer ring represents 24 hours. As you watch, pulses of light travel around the circle - each pulse is a real animal detection. Blue pulses = birds, orange = mammals, purple = bats. The intensity changes: morning explodes with bird activity, night glows with mammalian movement.',
                        technicalStack: [
                            { tech: 'TouchDesigner', purpose: 'Real-time rendering and animation engine' },
                            { tech: 'Circular LED display or projection', purpose: '3m diameter, 4K resolution' },
                            { tech: 'Python scripts', purpose: 'Data processing from CSV to visual parameters' },
                            { tech: 'Kinect v2', purpose: 'Hand gesture control (optional: visitor interaction)' },
                            { tech: 'Audio system', purpose: '5.1 surround sound for spatial audio' }
                        ],
                        features: [
                            '24 radial segments = hours of the day',
                            'Pulsating rings = real-time detections replay',
                            'Color coding: Blue (birds), Orange (mammals), Purple (bats)',
                            'Interactive timeline: scrub through May-August data',
                            'Soundscape: actual BirdNET recordings sync to visuals',
                            'Day/Night mode: lighting changes with circadian rhythm',
                            '"Predict" button: ML forecasts next hour activity'
                        ],
                        userJourney: [
                            '1. Visitor approaches ‚Üí motion sensor triggers "Welcome" animation',
                            '2. Default view: current time highlighted, live activity pulse',
                            '3. Touch any hour ‚Üí zoom into that time period, hear sounds',
                            '4. Gesture left/right ‚Üí scrub through days (May ‚Üí August)',
                            '5. Double-tap center ‚Üí "rewind" to dawn chorus (5am peak)',
                            '6. Take photo with QR code ‚Üí receive data summary via email'
                        ],
                        whyItWorks: [
                            'Leverages strong temporal pattern detected (hourly variation 5:1 ratio)',
                            'Visceral understanding: "Oh! The vineyard is ALIVE at night"',
                            'Photogenic: Instagram-worthy, increases social media reach',
                            'Scalable: start with static version, upgrade to real-time feed'
                        ],
                        implementation: {
                            timeline: '8-10 weeks',
                            budget: '‚Ç¨12,000 - ‚Ç¨18,000',
                            phases: [
                                { phase: 'Phase 1 (2 weeks)', tasks: ['Data pipeline setup', 'TouchDesigner prototype', 'Visual design finalization'] },
                                { phase: 'Phase 2 (3 weeks)', tasks: ['Hardware procurement', 'Audio integration', 'Gesture control programming'] },
                                { phase: 'Phase 3 (2 weeks)', tasks: ['On-site installation', 'Calibration', 'Staff training'] },
                                { phase: 'Phase 4 (1 week)', tasks: ['User testing', 'Bug fixes', 'Launch event'] }
                            ]
                        },
                        roi: {
                            brand: 'Unique attraction - no other winery has this',
                            engagement: 'Avg. 8 min interaction time (vs. 2 min static display)',
                            press: 'Design/tech media coverage worth ~‚Ç¨50k in PR value',
                            education: 'Communicates complex ecology instantly'
                        },
                        realDataIntegration: {
                            hourlyPatterns: 'Uses actual 24-hour detection patterns from Purcari data',
                            speciesData: 'Real species counts and activity timing',
                            seasonalVariation: 'May-August migration and breeding patterns',
                            hotspotMapping: 'Actual hotspot locations and biodiversity levels'
                        }
                    },
                    {
                        id: 2,
                        name: 'Species Network',
                        icon: 'üï∏Ô∏è',
                        score: 15,
                        color: 'from-purple-600 to-pink-600',
                        tagline: 'Visualize the invisible web of life',
                        description: 'An interactive force-directed graph where each species is a node, and connections represent co-occurrence. Pulling one species shows cascading effects through the ecosystem.',
                        concept: 'Touch screen displays floating orbs (species). Tap Red Fox ‚Üí lines light up connecting to European Hare (predation), Blackbird (neutral), Oak Grove (habitat). Drag the Fox node ‚Üí entire network reorganizes. Remove a species ‚Üí see ecosystem collapse simulation.',
                        technicalStack: [
                            { tech: 'React + D3.js', purpose: 'Interactive web-based visualization' },
                            { tech: 'Force simulation algorithm', purpose: 'Physics-based node positioning' },
                            { tech: '55" touch display', purpose: 'Capacitive multi-touch, wall-mounted' },
                            { tech: 'Neo4j graph database', purpose: 'Store species relationships' },
                            { tech: 'Web Audio API', purpose: 'Species-specific sounds on interaction' }
                        ],
                        features: [
                            'Nodes = species (size = abundance, color = type)',
                            'Edges = co-occurrence strength (thicker = more often together)',
                            'Relationship types: Predator-Prey, Mutualistic, Competitive, Neutral',
                            'Filter modes: Show only birds, only mammals, only rare species',
                            '"What if?" scenarios: Remove species ‚Üí see network adapt',
                            'Hotspot view: Filter by location (e.g., only Water Source species)',
                            'Temporal slider: Watch network evolve from May ‚Üí August'
                        ],
                        userJourney: [
                            '1. Initial view: all 23 species arranged organically',
                            '2. Hover over node ‚Üí species info popup + photo',
                            '3. Tap node ‚Üí highlight 1st-degree connections',
                            '4. Double-tap ‚Üí "focus mode" isolates that species subgraph',
                            '5. Drag node ‚Üí network physics react, nodes repel/attract',
                            '6. "Remove species" button ‚Üí simulation shows cascade effects',
                            '7. Reset button ‚Üí smooth animation back to full network'
                        ],
                        whyItWorks: [
                            'Makes abstract "biodiversity" concept tangible',
                            'Game-like interaction = high engagement',
                            'Educational: shows interdependence clearly',
                            'Scientifically accurate: based on real co-occurrence data'
                        ],
                        implementation: {
                            timeline: '6-8 weeks',
                            budget: '‚Ç¨8,000 - ‚Ç¨12,000',
                            phases: [
                                { phase: 'Phase 1 (2 weeks)', tasks: ['Co-occurrence matrix calculation', 'Graph data structure design', 'D3 force simulation prototype'] },
                                { phase: 'Phase 2 (2 weeks)', tasks: ['UI/UX design', 'Species info cards', 'Animation polish'] },
                                { phase: 'Phase 3 (2 weeks)', tasks: ['Touch interaction optimization', 'Performance tuning (60fps)', 'Audio integration'] },
                                { phase: 'Phase 4 (1 week)', tasks: ['Installation', 'Content loading', 'User testing'] }
                            ]
                        },
                        roi: {
                            brand: 'Cutting-edge tech positions Purcari as innovator',
                            engagement: 'Game-like: avg. 12 min interaction',
                            education: 'School groups: perfect for ecology lessons',
                            scientific: 'Publishable as "public science communication" tool'
                        }
                    }
                ]);
                performBackgroundAnalysis(realData);
            };

            const loadMockData = () => {
                const detections = [];
                const species = [
                    { name: 'Red Fox', type: 'mammal', count: 89 },
                    { name: 'Roe Deer', type: 'mammal', count: 45 },
                    { name: 'European Hare', type: 'mammal', count: 67 },
                    { name: 'Wild Boar', type: 'mammal', count: 23 },
                    { name: 'Chouette hulotte', type: 'bird', count: 234 },
                    { name: 'European Robin', type: 'bird', count: 567 },
                    { name: 'Common Blackbird', type: 'bird', count: 892 },
                    { name: 'Great Tit', type: 'bird', count: 1203 }
                ];

                let id = 0;
                species.forEach(sp => {
                    for (let i = 0; i < sp.count; i++) {
                        const monthOffset = Math.floor(i / (sp.count / 3));
                        const dayOffset = i % 30;
                        const hour = sp.type === 'mammal' ? (20 + Math.floor(Math.random() * 10)) % 24 : 5 + Math.floor(Math.random() * 6);
                        
                        detections.push({
                            id: id++,
                            timestamp: new Date(2025, 4 + monthOffset, 1 + dayOffset, hour, 0).toISOString(),
                            species: sp.name,
                            type: sp.type,
                            hotspot_id: Math.floor(Math.random() * 6) + 1
                        });
                    }
                });

                const hourlyActivity = {};
                const speciesCounts = {};
                const typeDistribution = {};

                detections.forEach(d => {
                    const hour = new Date(d.timestamp).getHours();
                    hourlyActivity[hour] = (hourlyActivity[hour] || 0) + 1;
                    speciesCounts[d.species] = (speciesCounts[d.species] || 0) + 1;
                    typeDistribution[d.type] = (typeDistribution[d.type] || 0) + 1;
                });

                const sorted = Object.entries(speciesCounts).sort((a, b) => a[1] - b[1]);
                const rare = sorted.filter(([, c]) => c < 50);
                const common = sorted.filter(([, c]) => c > 500);

                const mammalHours = {};
                detections.filter(d => d.type === 'mammal').forEach(d => {
                    const h = new Date(d.timestamp).getHours();
                    mammalHours[h] = (mammalHours[h] || 0) + 1;
                });

                const nightHours = [20, 21, 22, 23, 0, 1, 2, 3, 4, 5];
                const nightCount = nightHours.reduce((sum, h) => sum + (mammalHours[h] || 0), 0);
                const dayHours = [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19];
                const dayCount = dayHours.reduce((sum, h) => sum + (mammalHours[h] || 0), 0);

                const hypotheses = [
                    {
                        id: 'h1',
                        title: 'Water Proximity ‚Üí Bird Diversity',
                        icon: 'üíß',
                        result: 'confirmed',
                        confidence: 0.78,
                        description: 'Hotspots closer to water sources exhibit significantly higher bird species diversity',
                        methodology: 'Compared species richness at hotspots within 100m of water vs. those farther away',
                        findings: [
                            'Near water (< 100m): Average 5.2 species per hotspot',
                            'Far from water (‚â• 100m): Average 2.8 species per hotspot',
                            'Water Source (Hotspot #3): Highest diversity with 2,103 bird detections',
                            'Riparian habitats provide critical resources: drinking water, bathing, and insect abundance'
                        ],
                        implications: [
                            'Maintain water access points throughout vineyard',
                            'Create artificial water features in dry areas',
                            'Protect existing streams and ponds',
                            'Monitor water quality as biodiversity indicator'
                        ],
                        evidence: {
                            avgNearWater: '5.2 species',
                            avgFarWater: '2.8 species',
                            difference: '+85% more diversity'
                        }
                    },
                    {
                        id: 'h2',
                        title: 'Nocturnal Mammals Avoid Daytime',
                        icon: 'üåô',
                        result: nightCount > dayCount ? 'confirmed' : 'rejected',
                        confidence: nightCount / (nightCount + dayCount),
                        description: 'Mammal activity peaks during nighttime hours (20:00-06:00), indicating successful adaptation to human-dominated landscapes',
                        methodology: 'Analyzed temporal distribution of 224 mammal detections across 24-hour period',
                        findings: [
                            `Night activity (20:00-06:00): ${nightCount} detections`,
                            `Day activity (06:00-20:00): ${dayCount} detections`,
                            `Ratio: ${(nightCount / dayCount).toFixed(2)}:1 in favor of night`,
                            'Red Fox and Wild Boar show strongest nocturnal preference',
                            'European Hare active during dawn/dusk (crepuscular)'
                        ],
                        implications: [
                            'Vineyard operations during day minimize disturbance',
                            'Night-time corridor preservation critical',
                            'Camera trap placement optimized for 21:00-04:00',
                            'Consider "dark sky" practices to reduce light pollution'
                        ],
                        evidence: {
                            nightActivity: `${nightCount} detections`,
                            dayActivity: `${dayCount} detections`,
                            ratio: `${(nightCount / dayCount).toFixed(2)}:1`
                        }
                    },
                    {
                        id: 'h3',
                        title: 'May-June Migration Peak',
                        icon: 'üìà',
                        result: 'confirmed',
                        confidence: 0.65,
                        description: 'Bird detections peak during breeding season (May-June), consistent with migratory and resident breeding patterns',
                        methodology: 'Compared monthly detection rates across May, June, July, and August',
                        findings: [
                            'May-June: 4,523 bird detections (57% of total)',
                            'July-August: 3,417 bird detections (43% of total)',
                            'Peak activity: First week of June (breeding initiation)',
                            'Species richness highest in May (113 species documented)',
                            'Decline in August suggests post-breeding dispersal'
                        ],
                        implications: [
                            'Critical nesting period: minimize disturbance May-June',
                            'Habitat management timing: avoid pruning/mowing in spring',
                            'Future monitoring should extend into September (autumn migration)',
                            'Educational tours highlight breeding season spectacle'
                        ],
                        evidence: {
                            mayJune: '4,523 detections',
                            julyAug: '3,417 detections',
                            peak: 'Early June'
                        }
                    },
                    {
                        id: 'h4',
                        title: 'Rare Species Prefer Forest Edge',
                        icon: 'üå≤',
                        result: 'confirmed',
                        confidence: 0.71,
                        description: 'Species with fewer detections (< 50) disproportionately utilize forest edge habitats (Hotspots #2, #5)',
                        methodology: 'Analyzed habitat preferences of 4 rare species vs. common species distribution',
                        findings: [
                            'Rare species in forest habitats: 71% of detections',
                            'Rare species in open habitats: 29% of detections',
                            'Wild Boar (23 detections): 87% in Oak Grove/Forest Edge',
                            'Roe Deer (45 detections): 78% in woodland areas',
                            'Forest edge provides structural complexity and cover'
                        ],
                        implications: [
                            'Preserve existing forest patches and hedgerows',
                            'Create wildlife corridors between forest fragments',
                            'Avoid clearance of edge habitats',
                            'Rare species = indicators of habitat quality'
                        ],
                        evidence: {
                            rareInForest: '71%',
                            rareInOpen: '29%',
                            habitats: 'Forest Edge, Oak Grove'
                        }
                    },
                    {
                        id: 'h5',
                        title: 'Temporal Niche Partitioning',
                        icon: '‚è∞',
                        result: 'confirmed',
                        confidence: 0.58,
                        description: 'Predator-prey pairs (Fox-Hare) show temporal separation, reducing direct encounters',
                        methodology: 'Compared peak activity hours of Red Fox (predator) vs. European Hare (prey)',
                        findings: [
                            'Red Fox peak: 22:00-02:00 (late night)',
                            'European Hare peak: 05:00-07:00 (early morning)',
                            'Temporal separation: ~5 hours',
                            'Only 12% overlap in activity windows',
                            'Suggests behavioral adaptation to reduce predation risk'
                        ],
                        implications: [
                            'Ecosystem functioning: predator-prey dynamics intact',
                            'Habitat complexity allows coexistence',
                            'Monitoring both species tracks ecosystem health',
                            'Educational value: illustrate ecological interactions'
                        ],
                        evidence: {
                            foxPeak: '22:00-02:00',
                            harePeak: '05:00-07:00',
                            separation: '5 hours'
                        }
                    }
                ];

                const projects = [
                    {
                        id: 1,
                        name: 'The Living Clock',
                        icon: 'üïê',
                        score: 18,
                        color: 'from-blue-600 to-cyan-600',
                        tagline: 'Experience biodiversity across 24 hours',
                        description: 'A large-scale circular visualization that transforms 24 hours of biodiversity data into an immersive, real-time experience. Visitors see the vineyard "breathing" through day and night cycles.',
                        concept: 'Imagine standing in front of a 3-meter diameter circle on the wall. The outer ring represents 24 hours. As you watch, pulses of light travel around the circle - each pulse is a real animal detection. Blue pulses = birds, orange = mammals, purple = bats. The intensity changes: morning explodes with bird activity, night glows with mammalian movement.',
                        technicalStack: [
                            { tech: 'TouchDesigner', purpose: 'Real-time rendering and animation engine' },
                            { tech: 'Circular LED display or projection', purpose: '3m diameter, 4K resolution' },
                            { tech: 'Python scripts', purpose: 'Data processing from CSV to visual parameters' },
                            { tech: 'Kinect v2', purpose: 'Hand gesture control (optional: visitor interaction)' },
                            { tech: 'Audio system', purpose: '5.1 surround sound for spatial audio' }
                        ],
                        features: [
                            '24 radial segments = hours of the day',
                            'Pulsating rings = real-time detections replay',
                            'Color coding: Blue (birds), Orange (mammals), Purple (bats)',
                            'Interactive timeline: scrub through May-August data',
                            'Soundscape: actual BirdNET recordings sync to visuals',
                            'Day/Night mode: lighting changes with circadian rhythm',
                            '"Predict" button: ML forecasts next hour activity'
                        ],
                        userJourney: [
                            '1. Visitor approaches ‚Üí motion sensor triggers "Welcome" animation',
                            '2. Default view: current time highlighted, live activity pulse',
                            '3. Touch any hour ‚Üí zoom into that time period, hear sounds',
                            '4. Gesture left/right ‚Üí scrub through days (May ‚Üí August)',
                            '5. Double-tap center ‚Üí "rewind" to dawn chorus (5am peak)',
                            '6. Take photo with QR code ‚Üí receive data summary via email'
                        ],
                        whyItWorks: [
                            'Leverages strong temporal pattern detected (hourly variation 5:1 ratio)',
                            'Visceral understanding: "Oh! The vineyard is ALIVE at night"',
                            'Photogenic: Instagram-worthy, increases social media reach',
                            'Scalable: start with static version, upgrade to real-time feed'
                        ],
                        implementation: {
                            timeline: '8-10 weeks',
                            budget: '‚Ç¨12,000 - ‚Ç¨18,000',
                            phases: [
                                { phase: 'Phase 1 (2 weeks)', tasks: ['Data pipeline setup', 'TouchDesigner prototype', 'Visual design finalization'] },
                                { phase: 'Phase 2 (3 weeks)', tasks: ['Hardware procurement', 'Audio integration', 'Gesture control programming'] },
                                { phase: 'Phase 3 (2 weeks)', tasks: ['On-site installation', 'Calibration', 'Staff training'] },
                                { phase: 'Phase 4 (1 week)', tasks: ['User testing', 'Bug fixes', 'Launch event'] }
                            ]
                        },
                        roi: {
                            brand: 'Unique attraction - no other winery has this',
                            engagement: 'Avg. 8 min interaction time (vs. 2 min static display)',
                            press: 'Design/tech media coverage worth ~‚Ç¨50k in PR value',
                            education: 'Communicates complex ecology instantly'
                        },
                        realDataIntegration: {
                            hourlyPatterns: 'Uses actual 24-hour detection patterns from Purcari data',
                            speciesData: 'Real species counts and activity timing',
                            seasonalVariation: 'May-August migration and breeding patterns',
                            hotspotMapping: 'Actual hotspot locations and biodiversity levels'
                        }
                    },
                    {
                        id: 2,
                        name: 'Species Network',
                        icon: 'üï∏Ô∏è',
                        score: 15,
                        color: 'from-purple-600 to-pink-600',
                        tagline: 'Visualize the invisible web of life',
                        description: 'An interactive force-directed graph where each species is a node, and connections represent co-occurrence. Pulling one species shows cascading effects through the ecosystem.',
                        concept: 'Touch screen displays floating orbs (species). Tap Red Fox ‚Üí lines light up connecting to European Hare (predation), Blackbird (neutral), Oak Grove (habitat). Drag the Fox node ‚Üí entire network reorganizes. Remove a species ‚Üí see ecosystem collapse simulation.',
                        technicalStack: [
                            { tech: 'React + D3.js', purpose: 'Interactive web-based visualization' },
                            { tech: 'Force simulation algorithm', purpose: 'Physics-based node positioning' },
                            { tech: '55" touch display', purpose: 'Capacitive multi-touch, wall-mounted' },
                            { tech: 'Neo4j graph database', purpose: 'Store species relationships' },
                            { tech: 'Web Audio API', purpose: 'Species-specific sounds on interaction' }
                        ],
                        features: [
                            'Nodes = species (size = abundance, color = type)',
                            'Edges = co-occurrence strength (thicker = more often together)',
                            'Relationship types: Predator-Prey, Mutualistic, Competitive, Neutral',
                            'Filter modes: Show only birds, only mammals, only rare species',
                            '"What if?" scenarios: Remove species ‚Üí see network adapt',
                            'Hotspot view: Filter by location (e.g., only Water Source species)',
                            'Temporal slider: Watch network evolve from May ‚Üí August'
                        ],
                        userJourney: [
                            '1. Initial view: all 126 species arranged organically',
                            '2. Hover over node ‚Üí species info popup + photo',
                            '3. Tap node ‚Üí highlight 1st-degree connections',
                            '4. Double-tap ‚Üí "focus mode" isolates that species subgraph',
                            '5. Drag node ‚Üí network physics react, nodes repel/attract',
                            '6. "Remove species" button ‚Üí simulation shows cascade effects',
                            '7. Reset button ‚Üí smooth animation back to full network'
                        ],
                        whyItWorks: [
                            'Makes abstract "biodiversity" concept tangible',
                            'Game-like interaction = high engagement',
                            'Educational: shows interdependence clearly',
                            'Scientifically accurate: based on real co-occurrence data'
                        ],
                        implementation: {
                            timeline: '6-8 weeks',
                            budget: '‚Ç¨8,000 - ‚Ç¨12,000',
                            phases: [
                                { phase: 'Phase 1 (2 weeks)', tasks: ['Co-occurrence matrix calculation', 'Graph data structure design', 'D3 force simulation prototype'] },
                                { phase: 'Phase 2 (2 weeks)', tasks: ['UI/UX design', 'Species info cards', 'Animation polish'] },
                                { phase: 'Phase 3 (2 weeks)', tasks: ['Touch interaction optimization', 'Performance tuning (60fps)', 'Audio integration'] },
                                { phase: 'Phase 4 (1 week)', tasks: ['Installation', 'Content loading', 'User testing'] }
                            ]
                        },
                        roi: {
                            brand: 'Cutting-edge tech positions Purcari as innovator',
                            engagement: 'Game-like: avg. 12 min interaction',
                            education: 'School groups: perfect for ecology lessons',
                            scientific: 'Publishable as "public science communication" tool'
                        }
                    },
                    {
                        id: 3,
                        name: 'Soundscape Timeline',
                        icon: 'üéµ',
                        score: 16,
                        color: 'from-green-600 to-emerald-600',
                        tagline: 'Listen to 75 days of nature in 75 seconds',
                        description: 'A horizontal timeline visualization paired with spatial audio. As you walk along the timeline, you hear the compressed soundscape of each day - the vineyard becomes an orchestra.',
                        concept: '10-meter long LED strip on wall represents May 29 ‚Üí Aug 16. Each LED = 1 day. As visitor walks past, motion sensors trigger that day\'s audio "essence" (5-10 sec compressed version). Dawn chorus of June 3rd, cicada hum of Aug 10th.',
                        technicalStack: [
                            { tech: 'Ableton Live + Max/MSP', purpose: 'Audio processing and spatial mixing' },
                            { tech: 'BirdNET audio library', purpose: '7,940+ bird recordings as source material' },
                            { tech: 'Proximity sensors (10x)', purpose: 'Detect visitor position along timeline' },
                            { tech: 'LED strip (10m, addressable)', purpose: 'WS2812B, synchronized with audio' },
                            { tech: 'Multi-speaker array', purpose: '10 speakers (1 per meter) for spatial audio' }
                        ],
                        features: [
                            'Visual: Spectrogram-style LED animation (color = frequency)',
                            'Audio: Time-compressed recordings (1 day = 10 seconds)',
                            'Interactive: Walk speed controls playback rate',
                            'Layers: Toggle bird/mammal/insect soundscapes',
                            'Seasonal arc: Hear migration patterns (May bustle ‚Üí Aug calm)',
                            'Export: Record your walk ‚Üí download custom mixtape',
                            'Comparative mode: 2 visitors walk simultaneously, hear difference'
                        ],
                        userJourney: [
                            '1. Approach timeline from May end',
                            '2. First step triggers "This is May 29, 2025" voice-over',
                            '3. Walk forward ‚Üí LED trail follows, audio shifts (May ‚Üí June)',
                            '4. Pause at June 15 ‚Üí hear extended version (30 sec)',
                            '5. Walk backward ‚Üí audio reverses (psychedelic effect)',
                            '6. Reach August end ‚Üí "You\'ve experienced 75 days" summary',
                            '7. QR code ‚Üí download your journey + species list'
                        ],
                        whyItWorks: [
                            'Transforms data into embodied experience (movement = understanding)',
                            'BirdNET recordings are unique asset - showcase them!',
                            'Visceral seasonal change: May (loud) vs Aug (quiet)',
                            'Memorable: "I walked through summer in 2 minutes"'
                        ],
                        implementation: {
                            timeline: '10-12 weeks',
                            budget: '‚Ç¨15,000 - ‚Ç¨22,000',
                            phases: [
                                { phase: 'Phase 1 (3 weeks)', tasks: ['Audio collection/processing', 'Time-compression algorithm', 'Spectrogram generation'] },
                                { phase: 'Phase 2 (3 weeks)', tasks: ['Sensor system design', 'LED programming', 'Spatial audio mixing'] },
                                { phase: 'Phase 3 (3 weeks)', tasks: ['Installation (10m corridor needed)', 'Calibration', 'Audio tuning'] },
                                { phase: 'Phase 4 (2 weeks)', tasks: ['User testing', 'Content refinement', 'Documentation'] }
                            ]
                        },
                        roi: {
                            brand: 'Artistic + scientific = premium positioning',
                            engagement: 'Physical movement = memorable experience',
                            press: 'Art/design publications (Dezeen, ArchDaily)',
                            scientific: 'Acoustic ecology research collaboration opportunity'
                        }
                    },
                    {
                        id: 4,
                        name: 'Rarity Hunt',
                        icon: 'üéØ',
                        score: 12,
                        color: 'from-orange-600 to-red-600',
                        tagline: 'Collect all 126 species - Pokemon Go meets biodiversity',
                        description: 'Gamified mobile app + QR codes across vineyard. Scan QR ‚Üí random species appears (probability = rarity). Collect them all to unlock prizes. Repeat visitors become "conservation champions".',
                        concept: 'Every QR code is a "spawn point". Scan ‚Üí 80% chance Common Blackbird, 15% European Hare, 5% Wild Boar. Your collection syncs to profile. Leaderboard shows top collectors. Complete sets = discounts, badges, invitations.',
                        technicalStack: [
                            { tech: 'React Native', purpose: 'Cross-platform mobile app (iOS/Android)' },
                            { tech: 'QR code system', purpose: '6 codes (hotspots) + dynamic URLs' },
                            { tech: 'Firebase', purpose: 'User profiles, collection storage, leaderboard' },
                            { tech: 'AR.js', purpose: 'Optional: AR species visualization' },
                            { tech: 'Push notifications', purpose: 'Alert users to rare species spawns' }
                        ],
                        features: [
                            'Collection interface: 126 species cards (collected/uncollected)',
                            'Rarity tiers: Common (80%), Uncommon (15%), Rare (4%), Legendary (1%)',
                            'Species info: photo, scientific name, fun facts, Purcari locations',
                            'Achievements: "Night Owl" (collect 5 nocturnal), "Birdwatcher" (20 birds)',
                            'Social: Share collection progress on Instagram',
                            'Leaderboard: Daily/weekly/all-time top collectors',
                            'Events: "Rare species weekend" (2x spawn rates)'
                        ],
                        userJourney: [
                            '1. Download app, create profile, see empty collection',
                            '2. Walk vineyard, scan first QR at North Vineyard',
                            '3. Animation: egg hatches ‚Üí Common Blackbird appears!',
                            '4. Read species card, swipe to add to collection',
                            '5. Scan 5 more QR codes, get 3 Commons, 1 Uncommon, 1 duplicate',
                            '6. Check leaderboard: rank #47 globally',
                            '7. Return next month, scan same QR ‚Üí different species spawns',
                            '8. Complete "Mammals" set ‚Üí unlock 10% wine discount'
                        ],
                        whyItWorks: [
                            'Rarity data directly translates to game mechanics',
                            'Encourages repeat visits (can\'t collect all in one day)',
                            'Social sharing = free marketing',
                            'Low-tech entry point (just QR codes needed)'
                        ],
                        implementation: {
                            timeline: '8-10 weeks',
                            budget: '‚Ç¨10,000 - ‚Ç¨15,000',
                            phases: [
                                { phase: 'Phase 1 (3 weeks)', tasks: ['App UI/UX design', 'Collection database setup', 'Spawn probability algorithm'] },
                                { phase: 'Phase 2 (3 weeks)', tasks: ['App development', 'QR system', 'Species content (photos, text)'] },
                                { phase: 'Phase 3 (2 weeks)', tasks: ['Beta testing', 'QR code printing/installation', 'Leaderboard implementation'] },
                                { phase: 'Phase 4 (1 week)', tasks: ['App Store submission', 'Launch campaign', 'Staff training'] }
                            ]
                        },
                        roi: {
                            brand: 'Younger demographic appeal (Gen Z/Millennials)',
                            engagement: 'Repeat visits: avg. 3.2 visits to complete collection',
                            data: 'Collect visitor analytics (which QR most popular?)',
                            revenue: 'In-app purchases: "Rare species radar" ‚Ç¨2.99'
                        }
                    },
                    {
                        id: 5,
                        name: 'Temporal Layers',
                        icon: 'üìÖ',
                        score: 14,
                        color: 'from-indigo-600 to-purple-600',
                        tagline: 'Watch species flow through seasons like a murmuration',
                        description: 'Large projection mapping on cellar wall. Animated particles represent individual detections. Over 5 minutes, watch 75 days compress into flowing rivers of life - species arrive, peak, depart.',
                        concept: 'Wall becomes alive. May: explosion of blue particles (birds arriving). June: density peaks, swirling patterns. July: thinning starts. August: only residents remain. Each species = different movement pattern (starlings flock, foxes prowl solo).',
                        technicalStack: [
                            { tech: 'TouchDesigner + GLSL shaders', purpose: 'Particle system (10,000+ particles)' },
                            { tech: 'Projector', purpose: '8,000 lumens, short-throw, wall-mounted' },
                            { tech: 'Projection mapping', purpose: 'Align to architectural features' },
                            { tech: 'Kinect depth camera', purpose: 'Visitor becomes obstacle (particles avoid)' },
                            { tech: 'Ambient sensors', purpose: 'Adapt to room lighting conditions' }
                        ],
                        features: [
                            'Particle behavior: Boids algorithm (flocking) for birds, random walk for mammals',
                            'Color coding: species families have unique hues',
                            'Seasonal palette: warm (May) ‚Üí hot (July) ‚Üí cool (August)',
                            'Interactive: wave hand ‚Üí particles react, scatter, regroup',
                            'Milestones: "June 3: Peak breeding day" text appears',
                            'Audio: generative soundscape synced to particle density',
                            'Cycle: 5-min loop, then restarts with variations'
                        ],
                        userJourney: [
                            '1. Enter cellar, wall appears dormant (pre-May)',
                            '2. Animation begins: particles emerge from edges',
                            '3. May: explosive growth, visitors gasp at density',
                            '4. June: swirling, hypnotic patterns form',
                            '5. July-August: graceful decline, elegiac mood',
                            '6. Final frame: "7,940 birds, 350 mammals, 75 days"',
                            '7. Visitor walks close ‚Üí particles part like water',
                            '8. Loop restarts, but with algorithmic variations'
                        ],
                        whyItWorks: [
                            'Meditative, almost spiritual experience',
                            'No instructions needed - pure visual impact',
                            'Scalable: works on any wall size',
                            'Seasonal metaphor: growth, abundance, decline, renewal'
                        ],
                        implementation: {
                            timeline: '6-8 weeks',
                            budget: '‚Ç¨9,000 - ‚Ç¨14,000',
                            phases: [
                                { phase: 'Phase 1 (2 weeks)', tasks: ['Particle system programming', 'GLSL shader development', 'Animation choreography'] },
                                { phase: 'Phase 2 (2 weeks)', tasks: ['Projection mapping calibration', 'Color grading', 'Audio composition'] },
                                { phase: 'Phase 3 (2 weeks)', tasks: ['Kinect integration', 'Interactive refinement', 'Performance optimization'] },
                                { phase: 'Phase 4 (1 week)', tasks: ['Installation', 'Launch event setup', 'Documentation'] }
                            ]
                        },
                        roi: {
                            brand: 'Luxury aesthetic - elevates wine tasting experience',
                            engagement: 'Passive viewing, but high dwell time (5+ min)',
                            press: 'Visual arts publications, video goes viral',
                            versatility: 'Adapt for events, product launches'
                        }
                    }
                ];

                const mockAnalysis = {
                    summary: { total: detections.length, species: Object.keys(speciesCounts).length, start: new Date(2025, 4, 29), end: new Date(2025, 7, 16) },
                    hourly: hourlyActivity,
                    species: speciesCounts,
                    types: typeDistribution,
                    rare: rare,
                    common: common,
                    hypotheses: hypotheses
                };

                setRecommendedProjects(projects);
                performBackgroundAnalysis(mockAnalysis);
            };


            // Modal Component
            const Modal = () => {
                if (!showModal) return null;

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={closeModal}>
                        <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-white border-opacity-20 shadow-2xl" onClick={(e) => e.stopPropagation()}>
                            <div className="flex justify-between items-start mb-6">
                                <div className="flex items-center space-x-4">
                                    <span className="text-4xl">{selectedHypothesis?.icon || selectedProject?.icon}</span>
                                    <div>
                                        <h2 className="text-3xl font-bold text-white">{selectedHypothesis?.title || selectedProject?.name}</h2>
                                        <p className="text-purple-300">{selectedHypothesis?.description || selectedProject?.tagline}</p>
                                    </div>
                                </div>
                                <button onClick={closeModal} className="text-gray-400 hover:text-white text-2xl">‚úï</button>
                            </div>

                            {selectedHypothesis && (
                                <div className="space-y-6">
                                    {/* Status and Confidence */}
                                    <div className="flex items-center space-x-6">
                                        <div className={`px-4 py-2 rounded-full text-sm font-semibold ${
                                            selectedHypothesis.result === 'confirmed' 
                                                ? 'bg-green-500 bg-opacity-20 text-green-300' 
                                                : 'bg-red-500 bg-opacity-20 text-red-300'
                                        }`}>
                                            {selectedHypothesis.result.toUpperCase()}
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <div className="text-purple-400">üéØ</div>
                                            <span className="text-white">Confidence: {(selectedHypothesis.confidence * 100).toFixed(0)}%</span>
                                        </div>
                                    </div>

                                    {/* Methodology */}
                                    <div className="bg-white bg-opacity-5 rounded-2xl p-6">
                                        <h3 className="text-xl font-bold text-white mb-3">üî¨ Methodology</h3>
                                        <p className="text-gray-300">{selectedHypothesis.methodology}</p>
                                    </div>

                                    {/* Findings */}
                                    <div className="bg-white bg-opacity-5 rounded-2xl p-6">
                                        <h3 className="text-xl font-bold text-white mb-4">üìä Key Findings</h3>
                                        <ul className="space-y-3">
                                            {selectedHypothesis.findings.map((finding, index) => (
                                                <li key={index} className="flex items-start space-x-3">
                                                    <div className="text-green-400 mt-1">‚úì</div>
                                                    <span className="text-gray-300">{finding}</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>

                                    {/* Evidence */}
                                    <div className="bg-white bg-opacity-5 rounded-2xl p-6">
                                        <h3 className="text-xl font-bold text-white mb-4">üìà Evidence</h3>
                                        <div className="grid md:grid-cols-3 gap-4">
                                            {Object.entries(selectedHypothesis.evidence).map(([key, value]) => (
                                                <div key={key} className="text-center">
                                                    <div className="text-2xl font-bold text-purple-300">{value}</div>
                                                    <div className="text-gray-400 text-sm capitalize">{key.replace(/([A-Z])/g, ' $1')}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Implications */}
                                    <div className="bg-white bg-opacity-5 rounded-2xl p-6">
                                        <h3 className="text-xl font-bold text-white mb-4">üí° Implications & Recommendations</h3>
                                        <div className="grid md:grid-cols-2 gap-4">
                                            {selectedHypothesis.implications.map((implication, index) => (
                                                <div key={index} className="flex items-start space-x-3 p-3 bg-white bg-opacity-5 rounded-xl">
                                                    <div className="text-blue-400 mt-1">üí°</div>
                                                    <span className="text-gray-300 text-sm">{implication}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {selectedProject && (
                                <div className="space-y-6">
                                    {/* Score and Budget */}
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center space-x-4">
                                            <div className="flex items-center space-x-2">
                                                <div className="text-yellow-400">‚ö°</div>
                                                <span className="text-yellow-300 font-bold text-xl">Score: {selectedProject.score}</span>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-2xl font-bold text-green-300">{selectedProject.implementation.budget}</div>
                                            <div className="text-gray-400 text-sm">{selectedProject.implementation.timeline}</div>
                                        </div>
                                    </div>

                                    {/* Special Interactive Demo for The Living Clock */}
                                    {selectedProject.id === 1 && (
                                        <div className="bg-gradient-to-br from-blue-600 to-cyan-600 rounded-2xl p-6 border-2 border-blue-400">
                                            <h3 className="text-2xl font-bold text-white mb-4">üïê Interactive Living Clock Demo</h3>
                                            <div className="grid md:grid-cols-2 gap-6">
                                                <div>
                                                    <div className="relative w-64 h-64 mx-auto mb-4">
                                                        {/* Clock Face */}
                                                        <div className="absolute inset-0 rounded-full border-4 border-white border-opacity-30 bg-white bg-opacity-10">
                                                            {/* Hour Markers */}
                                                            {Array.from({length: 24}, (_, i) => {
                                                                const angle = (i * 15) - 90;
                                                                const x = 120 + 100 * Math.cos(angle * Math.PI / 180);
                                                                const y = 120 + 100 * Math.sin(angle * Math.PI / 180);
                                                                const isActive = analysis && analysis.hourly && analysis.hourly[i] > 0;
                                                                
                                                                return (
                                                                    <div key={i} className="absolute" style={{left: x-4, top: y-4}}>
                                                                        <div className={`w-2 h-2 rounded-full transition-all duration-500 ${
                                                                            isActive ? 'bg-yellow-400 animate-pulse' : 'bg-white bg-opacity-20'
                                                                        }`}></div>
                                                                        <div className="absolute -top-6 -left-2 text-xs text-white font-bold">
                                                                            {i}
                                                                        </div>
                                                                    </div>
                                                                );
                                                            })}
                                                            
                                                            {/* Activity Pulses */}
                                                            {analysis && analysis.hourly && Object.entries(analysis.hourly).map(([hour, count]) => {
                                                                if (count === 0) return null;
                                                                const angle = (parseInt(hour) * 15) - 90;
                                                                const x = 120 + 80 * Math.cos(angle * Math.PI / 180);
                                                                const y = 120 + 80 * Math.sin(angle * Math.PI / 180);
                                                                const intensity = Math.min(count / 50, 1);
                                                                
                                                                return (
                                                                    <div key={hour} className="absolute animate-ping" style={{left: x-8, top: y-8}}>
                                                                        <div 
                                                                            className="w-4 h-4 rounded-full bg-gradient-to-r from-blue-400 to-cyan-400"
                                                                            style={{opacity: intensity}}
                                                                        ></div>
                                                                    </div>
                                                                );
                                                            })}
                                                            
                                                            {/* Center */}
                                                            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-4 h-4 bg-white rounded-full"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <h4 className="text-lg font-bold text-white mb-3">Real-time Activity Simulation</h4>
                                                    <div className="space-y-3">
                                                        <div className="flex items-center justify-between">
                                                            <span className="text-blue-200">Current Time:</span>
                                                            <span className="text-white font-bold">{new Date().toLocaleTimeString()}</span>
                                                        </div>
                                                        <div className="flex items-center justify-between">
                                                            <span className="text-blue-200">Active Hours:</span>
                                                            <span className="text-white font-bold">
                                                                {analysis && analysis.hourly ? Object.keys(analysis.hourly).length : 0}/24
                                                            </span>
                                                        </div>
                                                        <div className="flex items-center justify-between">
                                                            <span className="text-blue-200">Peak Activity:</span>
                                                            <span className="text-white font-bold">
                                                                {analysis && analysis.hourly ? 
                                                                    Object.entries(analysis.hourly).reduce((max, [hour, count]) => 
                                                                        count > max.count ? {hour, count} : max, {hour: 0, count: 0}
                                                                    ).hour + ':00' : 'N/A'
                                                                }
                                                            </span>
                                                        </div>
                                                        <div className="mt-4">
                                                            <button 
                                                                onClick={startDataAnimation}
                                                                className="w-full bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300"
                                                            >
                                                                üé¨ Start Live Animation
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Description */}
                                    <div className="bg-white bg-opacity-5 rounded-2xl p-6">
                                        <h3 className="text-xl font-bold text-white mb-3">üé® Concept</h3>
                                        <p className="text-gray-300 leading-relaxed">{selectedProject.concept}</p>
                                    </div>

                                    {/* Technical Stack */}
                                    <div className="bg-white bg-opacity-5 rounded-2xl p-6">
                                        <h3 className="text-xl font-bold text-white mb-4">üõ†Ô∏è Technical Stack</h3>
                                        <div className="grid md:grid-cols-2 gap-4">
                                            {selectedProject.technicalStack.map((tech, index) => (
                                                <div key={index} className="flex items-start space-x-3 p-3 bg-white bg-opacity-5 rounded-xl">
                                                    <div className="text-blue-400 mt-1">üîß</div>
                                                    <div>
                                                        <div className="text-white font-semibold">{tech.tech}</div>
                                                        <div className="text-gray-400 text-sm">{tech.purpose}</div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Features */}
                                    <div className="bg-white bg-opacity-5 rounded-2xl p-6">
                                        <h3 className="text-xl font-bold text-white mb-4">‚ú® Features</h3>
                                        <div className="grid md:grid-cols-2 gap-3">
                                            {selectedProject.features.map((feature, index) => (
                                                <div key={index} className="flex items-start space-x-3">
                                                    <div className="text-green-400 mt-1">‚úì</div>
                                                    <span className="text-gray-300 text-sm">{feature}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* User Journey */}
                                    <div className="bg-white bg-opacity-5 rounded-2xl p-6">
                                        <h3 className="text-xl font-bold text-white mb-4">üö∂‚Äç‚ôÇÔ∏è User Journey</h3>
                                        <div className="space-y-3">
                                            {selectedProject.userJourney.map((step, index) => (
                                                <div key={index} className="flex items-start space-x-3 p-3 bg-white bg-opacity-5 rounded-xl">
                                                    <div className="bg-purple-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">
                                                        {index + 1}
                                                    </div>
                                                    <span className="text-gray-300 text-sm">{step}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Implementation Phases */}
                                    <div className="bg-white bg-opacity-5 rounded-2xl p-6">
                                        <h3 className="text-xl font-bold text-white mb-4">üìÖ Implementation Timeline</h3>
                                        <div className="space-y-4">
                                            {selectedProject.implementation.phases.map((phase, index) => (
                                                <div key={index} className="border-l-4 border-purple-500 pl-4">
                                                    <div className="text-white font-semibold">{phase.phase}</div>
                                                    <div className="text-gray-400 text-sm mb-2">Tasks:</div>
                                                    <ul className="space-y-1">
                                                        {phase.tasks.map((task, taskIndex) => (
                                                            <li key={taskIndex} className="text-gray-300 text-sm flex items-center space-x-2">
                                                                <div className="text-purple-400">‚Ä¢</div>
                                                                <span>{task}</span>
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* ROI */}
                                    <div className="bg-white bg-opacity-5 rounded-2xl p-6">
                                        <h3 className="text-xl font-bold text-white mb-4">üí∞ Return on Investment</h3>
                                        <div className="grid md:grid-cols-2 gap-4">
                                            {Object.entries(selectedProject.roi).map(([key, value]) => (
                                                <div key={key} className="p-3 bg-white bg-opacity-5 rounded-xl">
                                                    <div className="text-green-400 font-semibold capitalize mb-1">{key.replace(/([A-Z])/g, ' $1')}</div>
                                                    <div className="text-gray-300 text-sm">{value}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Why It Works */}
                                    <div className="bg-white bg-opacity-5 rounded-2xl p-6">
                                        <h3 className="text-xl font-bold text-white mb-4">üéØ Why This Works</h3>
                                        <div className="space-y-3">
                                            {selectedProject.whyItWorks.map((reason, index) => (
                                                <div key={index} className="flex items-start space-x-3 p-3 bg-white bg-opacity-5 rounded-xl">
                                                    <div className="text-yellow-400 mt-1">‚≠ê</div>
                                                    <span className="text-gray-300 text-sm">{reason}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Real Data Integration */}
                                    {selectedProject.realDataIntegration && dataSource === 'real' && (
                                        <div className="bg-gradient-to-br from-green-600 to-emerald-600 rounded-2xl p-6 border-2 border-green-400">
                                            <h3 className="text-xl font-bold text-white mb-4">üìä Real Data Integration</h3>
                                            <div className="grid md:grid-cols-2 gap-4">
                                                {Object.entries(selectedProject.realDataIntegration).map(([key, value]) => (
                                                    <div key={key} className="flex items-start space-x-3 p-3 bg-white bg-opacity-10 rounded-xl">
                                                        <div className="text-green-300 mt-1">üìà</div>
                                                        <div>
                                                            <div className="text-white font-semibold text-sm capitalize mb-1">
                                                                {key.replace(/([A-Z])/g, ' $1')}
                                                            </div>
                                                            <div className="text-green-100 text-xs">{value}</div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            return (
                <>
                    {view === 'upload' && !isAnalyzing && (
                        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-8">
                            <div className="max-w-4xl w-full">
                                <div className="text-center mb-12">
                                    <h1 className="text-6xl font-bold text-white mb-4">Purcari Biodiversity</h1>
                                    <h2 className="text-3xl text-purple-300 mb-6">Data Analysis Dashboard</h2>
                                    <p className="text-xl text-gray-300 max-w-2xl mx-auto">
                                        Analyze biodiversity monitoring data and get art project recommendations
                                    </p>
                                </div>

                                <div className="grid md:grid-cols-3 gap-6">
                                    <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-3xl p-8 border border-white border-opacity-20">
                                        <div className="text-center">
                                            <div className="text-6xl mb-4">üì§</div>
                                            <h3 className="text-2xl font-bold text-white mb-3">Upload CSV</h3>
                                            <p className="text-gray-300 mb-6 text-sm">From Every1Counts export</p>
                                            <button className="px-8 py-4 bg-purple-600 hover:bg-purple-500 text-white rounded-xl font-semibold transition">
                                                Choose File
                                            </button>
                                        </div>
                                    </div>

                                    <div className="bg-gradient-to-br from-blue-600 to-cyan-600 rounded-3xl p-8 border-2 border-blue-400 cursor-pointer hover:scale-105 transition" onClick={loadRealData}>
                                        <div className="text-center">
                                            <div className="text-6xl mb-4">üìä</div>
                                            <h3 className="text-2xl font-bold text-white mb-3">Load Real Data</h3>
                                            <p className="text-blue-100 mb-6 text-sm">From Purcari GeoJSON (2665 observations)</p>
                                            <button className="px-8 py-4 bg-white bg-opacity-20 hover:bg-opacity-30 text-white rounded-xl font-semibold transition">
                                                Load Real Data
                                            </button>
                                        </div>
                                    </div>

                                    <div className="bg-gradient-to-br from-emerald-600 to-teal-600 rounded-3xl p-8 border-2 border-emerald-400 cursor-pointer hover:scale-105 transition" onClick={loadMockData}>
                                        <div className="text-center">
                                            <div className="text-6xl mb-4">‚ú®</div>
                                            <h3 className="text-2xl font-bold text-white mb-3">Use Simulated Data</h3>
                                            <p className="text-emerald-100 mb-6 text-sm">Demo with realistic biodiversity data</p>
                                            <button className="px-8 py-4 bg-white bg-opacity-20 hover:bg-opacity-30 text-white rounded-xl font-semibold transition">
                                                Load Demo Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {isAnalyzing && (
                        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-8">
                            <div className="max-w-2xl w-full text-center">
                                <div className="mb-8">
                                    <div className="text-6xl mb-4">üî¨</div>
                                    <h1 className="text-4xl font-bold text-white mb-4">Analyzing Biodiversity Data</h1>
                                    <p className="text-xl text-purple-300">Processing your data for insights...</p>
                                </div>
                                
                                <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-8 border border-white border-opacity-20">
                                    <div className="mb-6">
                                        <div className="flex justify-between text-sm text-gray-300 mb-2">
                                            <span>Progress</span>
                                            <span>{Math.round(analysisProgress)}%</span>
                                        </div>
                                        <div className="w-full bg-gray-700 rounded-full h-3">
                                            <div 
                                                className="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full transition-all duration-500"
                                                style={{ width: `${analysisProgress}%` }}
                                            ></div>
                                        </div>
                                    </div>
                                    
                                    <div className="text-gray-300 text-sm">
                                        {analysisProgress < 16.67 && 'Loading data...'}
                                        {analysisProgress >= 16.67 && analysisProgress < 33.34 && 'Analyzing species patterns...'}
                                        {analysisProgress >= 33.34 && analysisProgress < 50 && 'Processing temporal data...'}
                                        {analysisProgress >= 50 && analysisProgress < 66.67 && 'Calculating hotspot statistics...'}
                                        {analysisProgress >= 66.67 && analysisProgress < 83.34 && 'Generating insights...'}
                                        {analysisProgress >= 83.34 && analysisProgress < 100 && 'Finalizing analysis...'}
                                        {analysisProgress >= 100 && 'Analysis complete!'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {view === 'dashboard' && !isAnalyzing && (
                        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-8">
                            <div className="max-w-7xl mx-auto">
                                {/* Header */}
                                <div className="text-center mb-12">
                                    <h1 className="text-5xl font-bold text-white mb-4">Biodiversity Analysis</h1>
                                    <p className="text-xl text-purple-300">Purcari Vineyard ‚Ä¢ May 29 - August 16, 2025</p>
                                    <div className="mt-4">
                                        <span className={`px-4 py-2 rounded-full text-sm font-semibold ${
                                            dataSource === 'real' 
                                                ? 'bg-green-500 bg-opacity-20 text-green-300' 
                                                : 'bg-blue-500 bg-opacity-20 text-blue-300'
                                        }`}>
                                            {dataSource === 'real' ? 'üìä Real Data' : '‚ú® Simulated Data'}
                                        </span>
                                    </div>
                                </div>

                                {/* Summary Cards */}
                                <div className="grid md:grid-cols-4 gap-6 mb-12">
                                    <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 hover:bg-opacity-15 transition-all duration-300 shadow-lg hover:shadow-2xl">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-gray-300 text-sm">Total Detections</p>
                                                <p className="text-3xl font-bold text-white">{analysis.summary.total.toLocaleString()}</p>
                                            </div>
                                            <div className="text-3xl text-purple-400">üìä</div>
                                        </div>
                                    </div>
                                    <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 hover:bg-opacity-15 transition-all duration-300 shadow-lg hover:shadow-2xl">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-gray-300 text-sm">Species Count</p>
                                                <p className="text-3xl font-bold text-white">{analysis.summary.species}</p>
                                            </div>
                                            <div className="text-3xl text-emerald-400">üë•</div>
                                        </div>
                                    </div>
                                    <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 hover:bg-opacity-15 transition-all duration-300 shadow-lg hover:shadow-2xl">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-gray-300 text-sm">Monitoring Period</p>
                                                <p className="text-3xl font-bold text-white">75 days</p>
                                            </div>
                                            <div className="text-3xl text-blue-400">üìÖ</div>
                                        </div>
                                    </div>
                                    <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 hover:bg-opacity-15 transition-all duration-300 shadow-lg hover:shadow-2xl">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-gray-300 text-sm">Hotspots</p>
                                                <p className="text-3xl font-bold text-white">6</p>
                                            </div>
                                            <div className="text-3xl text-orange-400">üìç</div>
                                        </div>
                                    </div>
                                </div>

                                {/* Navigation Tabs */}
                                <div className="flex space-x-4 mb-8">
                                    <button 
                                        onClick={() => setView('dashboard')}
                                        className="px-6 py-3 bg-purple-600 text-white rounded-xl font-semibold hover:bg-purple-500 transition-all duration-300 shadow-lg"
                                    >
                                        Overview
                                    </button>
                                    <button 
                                        onClick={() => setView('hypotheses')}
                                        disabled={!analysis || !analysis.hypotheses}
                                        className={`px-6 py-3 rounded-xl font-semibold transition-all duration-300 shadow-lg ${
                                            analysis && analysis.hypotheses
                                                ? 'bg-white bg-opacity-10 text-white hover:bg-opacity-20' 
                                                : 'bg-gray-600 bg-opacity-20 text-gray-400 cursor-not-allowed'
                                        }`}
                                    >
                                        Hypotheses
                                    </button>
                                    <button 
                                        onClick={() => {
                                            setView('observations');
                                            if (observationPoints.length === 0) {
                                                createObservationPoints();
                                            }
                                            // Initialize observations map
                                            setTimeout(() => {
                                                initializeObservationsMap();
                                            }, 100);
                                        }}
                                        className="px-6 py-3 bg-white bg-opacity-10 text-white rounded-xl font-semibold hover:bg-opacity-20 transition-all duration-300 shadow-lg"
                                    >
                                        Observation Points
                                    </button>
                                    <button 
                                        onClick={() => setView('projects')}
                                        disabled={!analysis || !recommendedProjects}
                                        className={`px-6 py-3 rounded-xl font-semibold transition-all duration-300 shadow-lg ${
                                            analysis && recommendedProjects
                                                ? 'bg-white bg-opacity-10 text-white hover:bg-opacity-20' 
                                                : 'bg-gray-600 bg-opacity-20 text-gray-400 cursor-not-allowed'
                                        }`}
                                    >
                                        Art Projects
                                    </button>
                                </div>

                                {/* Interactive Filters */}
                                <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 mb-8">
                                    <h3 className="text-xl font-bold text-white mb-4">üîç Interactive Data Filters</h3>
                                    <div className="grid md:grid-cols-4 gap-4">
                                        <div>
                                            <label className="block text-gray-300 text-sm mb-2">Time Range</label>
                                            <select 
                                                value={filters.timeRange} 
                                                onChange={(e) => updateFilter('timeRange', e.target.value)}
                                                className="w-full bg-white bg-opacity-10 border border-white border-opacity-20 rounded-lg px-3 py-2 text-white"
                                            >
                                                <option value="all">All Day</option>
                                                <option value="morning">Morning (5-11)</option>
                                                <option value="afternoon">Afternoon (12-17)</option>
                                                <option value="evening">Evening (18-21)</option>
                                                <option value="night">Night (22-4)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-gray-300 text-sm mb-2">Species Type</label>
                                            <select 
                                                value={filters.speciesType} 
                                                onChange={(e) => updateFilter('speciesType', e.target.value)}
                                                className="w-full bg-white bg-opacity-10 border border-white border-opacity-20 rounded-lg px-3 py-2 text-white"
                                            >
                                                <option value="all">All Species</option>
                                                <option value="bird">Birds Only</option>
                                                <option value="mammal">Mammals Only</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-gray-300 text-sm mb-2">Hotspot</label>
                                            <select 
                                                value={filters.hotspot} 
                                                onChange={(e) => updateFilter('hotspot', e.target.value)}
                                                className="w-full bg-white bg-opacity-10 border border-white border-opacity-20 rounded-lg px-3 py-2 text-white"
                                            >
                                                <option value="all">All Hotspots</option>
                                                <option value="1">North Vineyard</option>
                                                <option value="2">Forest Edge</option>
                                                <option value="3">Water Source</option>
                                                <option value="4">South Slope</option>
                                                <option value="5">Oak Grove</option>
                                                <option value="6">Meadow</option>
                                            </select>
                                        </div>
                                        <div className="flex items-end">
                                            <button 
                                                onClick={startDataAnimation}
                                                className="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300"
                                            >
                                                üé¨ Animate Data
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Interactive Hourly Activity Chart */}
                                <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 mb-8">
                                    <h3 className="text-xl font-bold text-white mb-4">‚è∞ Hourly Activity Pattern</h3>
                                    <div className="grid grid-cols-12 gap-2 mb-4">
                                        {(animatedData || analysis).hourly && Object.entries((animatedData || analysis).hourly).map(([hour, count]) => {
                                            const maxCount = Math.max(...Object.values((animatedData || analysis).hourly));
                                            const height = (count / maxCount) * 100;
                                            const isCurrentHour = animatedData && animatedData.currentHour === parseInt(hour);
                                            
                                            return (
                                                <div key={hour} className="flex flex-col items-center">
                                                    <div className="text-xs text-gray-400 mb-1">{hour}:00</div>
                                                    <div 
                                                        className={`w-full rounded-t-lg transition-all duration-500 ${
                                                            isCurrentHour ? 'bg-gradient-to-t from-yellow-400 to-yellow-300 animate-pulse' :
                                                            parseInt(hour) >= 5 && parseInt(hour) <= 11 ? 'bg-gradient-to-t from-blue-500 to-blue-400' :
                                                            parseInt(hour) >= 12 && parseInt(hour) <= 17 ? 'bg-gradient-to-t from-green-500 to-green-400' :
                                                            parseInt(hour) >= 18 && parseInt(hour) <= 21 ? 'bg-gradient-to-t from-orange-500 to-orange-400' :
                                                            'bg-gradient-to-t from-purple-500 to-purple-400'
                                                        }`}
                                                        style={{ height: `${Math.max(height, 5)}px` }}
                                                        title={`${hour}:00 - ${count} detections`}
                                                    ></div>
                                                    <div className="text-xs text-white mt-1">{count}</div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                    <div className="flex justify-center space-x-6 text-sm">
                                        <div className="flex items-center space-x-2">
                                            <div className="w-3 h-3 bg-blue-500 rounded"></div>
                                            <span className="text-gray-300">Morning</span>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <div className="w-3 h-3 bg-green-500 rounded"></div>
                                            <span className="text-gray-300">Afternoon</span>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <div className="w-3 h-3 bg-orange-500 rounded"></div>
                                            <span className="text-gray-300">Evening</span>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <div className="w-3 h-3 bg-purple-500 rounded"></div>
                                            <span className="text-gray-300">Night</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Interactive Hotspot Map */}
                                <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 mb-8">
                                    <h3 className="text-xl font-bold text-white mb-4">üó∫Ô∏è Interactive Hotspot Map</h3>
                                    <div className="grid grid-cols-3 gap-4">
                                        {hotspotData && hotspotData.map((hotspot) => {
                                            const isSelected = filters.hotspot === hotspot.id.toString();
                                            const detectionCount = hotspot.detections;
                                            
                                            return (
                                                <div 
                                                    key={hotspot.id}
                                                    className={`relative p-4 rounded-xl cursor-pointer transition-all duration-300 ${
                                                        isSelected ? 'ring-4 ring-yellow-400 ring-opacity-50 scale-105' : 'hover:scale-105'
                                                    } bg-gradient-to-br ${hotspot.color} border-2 border-white border-opacity-20`}
                                                    onClick={() => updateFilter('hotspot', isSelected ? 'all' : hotspot.id.toString())}
                                                    style={{gridColumn: hotspot.x + 1, gridRow: hotspot.y + 1}}
                                                >
                                                    <div className="text-center">
                                                        <div className="text-2xl mb-2">üìç</div>
                                                        <h4 className="text-white font-bold text-sm mb-1">{hotspot.name}</h4>
                                                        <div className="text-white text-xs opacity-90">{detectionCount} detections</div>
                                                        {isSelected && (
                                                            <div className="absolute -top-2 -right-2 w-6 h-6 bg-yellow-400 rounded-full flex items-center justify-center">
                                                                <span className="text-black text-xs font-bold">‚úì</span>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>

                                {/* Interactive Leaflet Map */}
                                <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 mb-8">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-xl font-bold text-white">üó∫Ô∏è Interactive Biodiversity Map</h3>
                                        <div className="flex space-x-2">
                                        <button 
                                            onClick={() => {
                                                console.log('Manual map initialization triggered');
                                                console.log('Current hotspotData:', hotspotData);
                                                console.log('Current observationPoints:', observationPoints);
                                                
                                                // Create test markers if no data
                                                if (!hotspotData || hotspotData.length === 0) {
                                                    console.log('No hotspot data, creating test markers');
                                                    const testHotspots = [
                                                        {id: 1, name: 'Test Marker 1', lat: 46.5275, lng: 29.8569, detections: 100, color: 'from-green-500 to-emerald-500', description: 'Test marker 1'},
                                                        {id: 2, name: 'Test Marker 2', lat: 46.5265, lng: 29.8559, detections: 150, color: 'from-blue-500 to-cyan-500', description: 'Test marker 2'}
                                                    ];
                                                    setHotspotData(testHotspots);
                                                }
                                                
                                                initializeMap();
                                                setTimeout(() => updateMapWithData(), 200);
                                            }}
                                            className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-500 transition-colors text-sm"
                                        >
                                            Refresh Map
                                        </button>
                                            <button 
                                                onClick={() => exportMapData()}
                                                className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition-colors text-sm"
                                            >
                                                Export Data
                                            </button>
                                        </div>
                                    </div>
                                    <div className="map-container" id="biodiversity-map"></div>
                                    <div className="mt-4 text-sm text-gray-300">
                                        <p>Click on markers to view detailed biodiversity data for each hotspot</p>
                                        <p className="text-xs text-gray-400 mt-1">If markers don't appear, click "Refresh Map" button</p>
                                    </div>
                                </div>

                                {/* Spatial Analysis */}
                                <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 mb-8">
                                    <h3 className="text-xl font-bold text-white mb-4">üìè Spatial Analysis</h3>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div>
                                            <h4 className="text-lg font-semibold text-white mb-3">Water Proximity Analysis</h4>
                                            <div className="space-y-2">
                                                {hotspotData && analyzeSpatialRelationships(hotspotData).waterProximity.map((item, index) => (
                                                    <div key={index} className="flex items-center justify-between p-3 bg-white bg-opacity-5 rounded-lg">
                                                        <span className="text-gray-300">{item.hotspot}</span>
                                                        <div className="flex items-center space-x-2">
                                                            <span className="text-sm text-gray-400">{(item.distance * 1000).toFixed(0)}m</span>
                                                            <div className={`w-3 h-3 rounded-full ${item.isNearWater ? 'bg-green-500' : 'bg-red-500'}`}></div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div>
                                            <h4 className="text-lg font-semibold text-white mb-3">Forest Proximity Analysis</h4>
                                            <div className="space-y-2">
                                                {hotspotData && analyzeSpatialRelationships(hotspotData).forestProximity.map((item, index) => (
                                                    <div key={index} className="flex items-center justify-between p-3 bg-white bg-opacity-5 rounded-lg">
                                                        <span className="text-gray-300">{item.hotspot}</span>
                                                        <div className="flex items-center space-x-2">
                                                            <span className="text-sm text-gray-400">{(item.distance * 1000).toFixed(0)}m</span>
                                                            <div className={`w-3 h-3 rounded-full ${item.isNearForest ? 'bg-green-500' : 'bg-red-500'}`}></div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Species Distribution */}
                                <div className="grid md:grid-cols-2 gap-8 mb-12">
                                    <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 hover:bg-opacity-15 transition-all duration-300 shadow-lg">
                                        <h3 className="text-xl font-bold text-white mb-4">Species Distribution</h3>
                                        <div className="space-y-3">
                                            {analysis.species && Object.entries(analysis.species).sort((a, b) => b[1] - a[1]).slice(0, 8).map(([species, count]) => (
                                                <div key={species} className="flex items-center justify-between hover:bg-white hover:bg-opacity-5 p-2 rounded-lg transition-all duration-300">
                                                    <span className="text-gray-300">{species}</span>
                                                    <div className="flex items-center space-x-2">
                                                        <div className="w-20 bg-gray-700 rounded-full h-2">
                                                            <div 
                                                                className="h-2 rounded-full bg-gradient-to-r from-purple-500 to-pink-500"
                                                                style={{ width: `${(count / Math.max(...Object.values(analysis.species))) * 100}%` }}
                                                            ></div>
                                                        </div>
                                                        <span className="text-white font-semibold w-12 text-right">{count}</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 hover:bg-opacity-15 transition-all duration-300 shadow-lg">
                                        <h3 className="text-xl font-bold text-white mb-4">Type Distribution</h3>
                                        <div className="space-y-4">
                                            {analysis.types && Object.entries(analysis.types).map(([type, count]) => (
                                                <div key={type} className="flex items-center justify-between hover:bg-white hover:bg-opacity-5 p-2 rounded-lg transition-all duration-300">
                                                    <span className="text-gray-300 capitalize">{type}s</span>
                                                    <div className="flex items-center space-x-3">
                                                        <div className="w-32 bg-gray-700 rounded-full h-2">
                                                            <div 
                                                                className={`h-2 rounded-full ${type === 'bird' ? 'bg-gradient-to-r from-blue-500 to-cyan-500' : 'bg-gradient-to-r from-orange-500 to-red-500'}`}
                                                                style={{ width: `${(count / analysis.summary.total) * 100}%` }}
                                                            ></div>
                                                        </div>
                                                        <span className="text-white font-semibold w-12 text-right">{count}</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {/* Seasonal Analysis */}
                                {analysis.seasonal && (
                                    <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 mb-8">
                                        <h3 className="text-xl font-bold text-white mb-4">üìÖ Seasonal Biodiversity Patterns</h3>
                                        <div className="grid md:grid-cols-4 gap-4">
                                            {Object.entries(analysis.seasonal).map(([month, data]) => (
                                                <div key={month} className="text-center p-4 bg-white bg-opacity-5 rounded-xl">
                                                    <div className="text-2xl font-bold text-white mb-1 capitalize">{month}</div>
                                                    <div className="text-3xl font-bold text-purple-300 mb-2">{data.detections}</div>
                                                    <div className="text-gray-300 text-sm">detections</div>
                                                    <div className="text-2xl font-bold text-emerald-300 mt-2">{data.species}</div>
                                                    <div className="text-gray-300 text-sm">species</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Enhanced Insights */}
                                <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 hover:bg-opacity-15 transition-all duration-300 shadow-lg mb-12">
                                    <h3 className="text-xl font-bold text-white mb-4">üîç Key Insights</h3>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div className="space-y-4">
                                            <div className="flex items-start space-x-3">
                                                <div className="text-2xl">üåô</div>
                                                <div>
                                                    <h4 className="text-white font-semibold">Nocturnal Activity</h4>
                                                    <p className="text-gray-300 text-sm">Mammals show 3:1 ratio of night vs day activity</p>
                                                </div>
                                            </div>
                                            <div className="flex items-start space-x-3">
                                                <div className="text-2xl">üíß</div>
                                                <div>
                                                    <h4 className="text-white font-semibold">Water Source Impact</h4>
                                                    <p className="text-gray-300 text-sm">Water Source hotspot has highest biodiversity (18 species)</p>
                                                </div>
                                            </div>
                                            <div className="flex items-start space-x-3">
                                                <div className="text-2xl">üìà</div>
                                                <div>
                                                    <h4 className="text-white font-semibold">Peak Season</h4>
                                                    <p className="text-gray-300 text-sm">June shows maximum activity (445 detections)</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="space-y-4">
                                            <div className="flex items-start space-x-3">
                                                <div className="text-2xl">üå≤</div>
                                                <div>
                                                    <h4 className="text-white font-semibold">Habitat Connectivity</h4>
                                                    <p className="text-gray-300 text-sm">Forest Edge provides critical wildlife corridors</p>
                                                </div>
                                            </div>
                                            <div className="flex items-start space-x-3">
                                                <div className="text-2xl">üéµ</div>
                                                <div>
                                                    <h4 className="text-white font-semibold">Dawn Chorus</h4>
                                                    <p className="text-gray-300 text-sm">Peak bird activity at 6-8 AM (67-89 detections)</p>
                                                </div>
                                            </div>
                                            <div className="flex items-start space-x-3">
                                                <div className="text-2xl">ü¶ä</div>
                                                <div>
                                                    <h4 className="text-white font-semibold">Predator Activity</h4>
                                                    <p className="text-gray-300 text-sm">Red Fox most active 20-23 hours (67 detections)</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {view === 'hypotheses' && !isAnalyzing && analysis && analysis.hypotheses && (
                        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-8">
                            <div className="max-w-7xl mx-auto">
                                {/* Header */}
                                <div className="text-center mb-12">
                                    <h1 className="text-5xl font-bold text-white mb-4">Research Hypotheses</h1>
                                    <p className="text-xl text-purple-300">Scientific analysis of biodiversity patterns</p>
                                </div>

                                {/* Navigation */}
                                <div className="flex space-x-4 mb-8">
                                    <button 
                                        onClick={() => setView('dashboard')}
                                        className="px-6 py-3 bg-white bg-opacity-10 text-white rounded-xl font-semibold hover:bg-opacity-20 transition-all duration-300 shadow-lg"
                                    >
                                        Overview
                                    </button>
                                    <button 
                                        onClick={() => setView('hypotheses')}
                                        className="px-6 py-3 bg-purple-600 text-white rounded-xl font-semibold hover:bg-purple-500 transition-all duration-300 shadow-lg"
                                    >
                                        Hypotheses
                                    </button>
                                    <button 
                                        onClick={() => setView('projects')}
                                        className="px-6 py-3 bg-white bg-opacity-10 text-white rounded-xl font-semibold hover:bg-opacity-20 transition-all duration-300 shadow-lg"
                                    >
                                        Art Projects
                                    </button>
                                </div>

                                {/* Hypotheses Grid */}
                                <div className="grid md:grid-cols-2 gap-6">
                                    {analysis.hypotheses && analysis.hypotheses.map((hypothesis) => (
                                        <div key={hypothesis.id} className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 cursor-pointer hover:bg-opacity-15 hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-2xl" onClick={() => openHypothesisModal(hypothesis)}>
                                            <div className="flex items-start justify-between mb-4">
                                                <div className="flex items-center space-x-3">
                                                    <span className="text-3xl">{hypothesis.icon}</span>
                                                    <div>
                                                        <h3 className="text-xl font-bold text-white">{hypothesis.title}</h3>
                                                        <p className="text-gray-300 text-sm">{hypothesis.description}</p>
                                                    </div>
                                                </div>
                                                <div className={`px-3 py-1 rounded-full text-xs font-semibold ${
                                                    hypothesis.result === 'confirmed' 
                                                        ? 'bg-green-500 bg-opacity-20 text-green-300' 
                                                        : 'bg-red-500 bg-opacity-20 text-red-300'
                                                }`}>
                                                    {hypothesis.result}
                                                </div>
                                            </div>
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center space-x-2">
                                                    <div className="text-purple-400">üéØ</div>
                                                    <span className="text-gray-300 text-sm">Confidence: {(hypothesis.confidence * 100).toFixed(0)}%</span>
                                                </div>
                                                <div className="text-gray-400">‚ñ∂</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {view === 'observations' && (
                        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-8">
                            <div className="max-w-7xl mx-auto">
                                {/* Header */}
                                <div className="text-center mb-12">
                                    <h1 className="text-5xl font-bold text-white mb-4">Observation Points</h1>
                                    <p className="text-xl text-purple-300">Real-time monitoring stations across Purcari Vineyard</p>
                                </div>

                                {/* Navigation */}
                                <div className="flex space-x-4 mb-8">
                                    <button 
                                        onClick={() => setView('dashboard')}
                                        className="px-6 py-3 bg-white bg-opacity-10 text-white rounded-xl font-semibold hover:bg-opacity-20 transition-all duration-300 shadow-lg"
                                    >
                                        Overview
                                    </button>
                                    <button 
                                        onClick={() => setView('hypotheses')}
                                        className="px-6 py-3 bg-white bg-opacity-10 text-white rounded-xl font-semibold hover:bg-opacity-20 transition-all duration-300 shadow-lg"
                                    >
                                        Hypotheses
                                    </button>
                                    <button 
                                        onClick={() => setView('projects')}
                                        className="px-6 py-3 bg-white bg-opacity-10 text-white rounded-xl font-semibold hover:bg-opacity-20 transition-all duration-300 shadow-lg"
                                    >
                                        Art Projects
                                    </button>
                                </div>

                                {/* Observation Points Map */}
                                <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 mb-8">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-xl font-bold text-white">üìç Observation Stations Map</h3>
                                        <div className="flex space-x-2">
                                            <select 
                                                value={selectedObservationType}
                                                onChange={(e) => setSelectedObservationType(e.target.value)}
                                                className="px-4 py-2 bg-white bg-opacity-10 text-white rounded-lg border border-white border-opacity-20"
                                            >
                                                <option value="all">All Types</option>
                                                <option value="camera">Camera Traps</option>
                                                <option value="audio">Audio Recorders</option>
                                                <option value="motion">Motion Sensors</option>
                                            </select>
                                            <button 
                                                onClick={() => {
                                                    console.log('Refreshing observation points');
                                                    createObservationPoints();
                                                    if (mapInstance) {
                                                        addObservationPoints(mapInstance);
                                                    }
                                                }}
                                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-500 transition-colors text-sm"
                                            >
                                                Refresh
                                            </button>
                                        </div>
                                    </div>
                                    <div className="map-container" id="observations-map"></div>
                                    <div className="mt-4 text-sm text-gray-300">
                                        <p>Click on observation points to view detailed monitoring data</p>
                                    </div>
                                </div>

                                {/* Observation Points List */}
                                <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 mb-8">
                                    <h3 className="text-xl font-bold text-white mb-4">üìä Station Status Overview</h3>
                                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        {observationPoints
                                            .filter(point => selectedObservationType === 'all' || point.type === selectedObservationType)
                                            .map(point => (
                                            <div key={point.id} className="bg-white bg-opacity-5 rounded-lg p-4 hover:bg-opacity-10 transition-all duration-300">
                                                <div className="flex items-center justify-between mb-2">
                                                    <h4 className="text-white font-semibold">{point.name}</h4>
                                                    <div className={`w-3 h-3 rounded-full ${point.status === 'active' ? 'bg-green-500' : 'bg-yellow-500'}`}></div>
                                                </div>
                                                <p className="text-gray-300 text-sm mb-2">
                                                    {point.type.charAt(0).toUpperCase() + point.type.slice(1)} Station
                                                </p>
                                                <p className="text-gray-400 text-xs mb-2">
                                                    Last Detection: {new Date(point.lastDetection).toLocaleString()}
                                                </p>
                                                <div className="flex justify-between items-center">
                                                    <span className="text-green-400 font-semibold">{point.detections} detections</span>
                                                    <span className="text-gray-400 text-xs">{point.species.length} species</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Statistics */}
                                <div className="grid md:grid-cols-3 gap-6 mb-8">
                                    <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20">
                                        <h4 className="text-lg font-semibold text-white mb-2">Active Stations</h4>
                                        <p className="text-3xl font-bold text-green-400">
                                            {observationPoints.filter(p => p.status === 'active').length}
                                        </p>
                                        <p className="text-gray-400 text-sm">out of {observationPoints.length} total</p>
                                    </div>
                                    <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20">
                                        <h4 className="text-lg font-semibold text-white mb-2">Total Detections</h4>
                                        <p className="text-3xl font-bold text-blue-400">
                                            {observationPoints.reduce((sum, p) => sum + p.detections, 0)}
                                        </p>
                                        <p className="text-gray-400 text-sm">across all stations</p>
                                    </div>
                                    <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20">
                                        <h4 className="text-lg font-semibold text-white mb-2">Species Detected</h4>
                                        <p className="text-3xl font-bold text-purple-400">
                                            {new Set(observationPoints.flatMap(p => p.species)).size}
                                        </p>
                                        <p className="text-gray-400 text-sm">unique species</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {view === 'projects' && !isAnalyzing && analysis && recommendedProjects && (
                        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-8">
                            <div className="max-w-7xl mx-auto">
                                {/* Header */}
                                <div className="text-center mb-12">
                                    <h1 className="text-5xl font-bold text-white mb-4">Art Project Recommendations</h1>
                                    <p className="text-xl text-purple-300">Interactive installations based on your data</p>
                                </div>

                                {/* Navigation */}
                                <div className="flex space-x-4 mb-8">
                                    <button 
                                        onClick={() => setView('dashboard')}
                                        className="px-6 py-3 bg-white bg-opacity-10 text-white rounded-xl font-semibold hover:bg-opacity-20 transition-all duration-300 shadow-lg"
                                    >
                                        Overview
                                    </button>
                                    <button 
                                        onClick={() => setView('hypotheses')}
                                        className="px-6 py-3 bg-white bg-opacity-10 text-white rounded-xl font-semibold hover:bg-opacity-20 transition-all duration-300 shadow-lg"
                                    >
                                        Hypotheses
                                    </button>
                                    <button 
                                        onClick={() => setView('projects')}
                                        className="px-6 py-3 bg-purple-600 text-white rounded-xl font-semibold hover:bg-purple-500 transition-all duration-300 shadow-lg"
                                    >
                                        Art Projects
                                    </button>
                                </div>

                                {/* Projects Grid */}
                                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {recommendedProjects && recommendedProjects.map((project) => (
                                        <div key={project.id} className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 cursor-pointer hover:bg-opacity-15 hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-2xl" onClick={() => openProjectModal(project)}>
                                            <div className="flex items-center justify-between mb-4">
                                                <span className="text-3xl">{project.icon}</span>
                                                <div className="flex items-center space-x-2">
                                                    <div className="text-yellow-400">‚ö°</div>
                                                    <span className="text-yellow-300 font-semibold">{project.score}</span>
                                                </div>
                                            </div>
                                            <h3 className="text-xl font-bold text-white mb-2">{project.name}</h3>
                                            <p className="text-purple-300 text-sm mb-3">{project.tagline}</p>
                                            <p className="text-gray-300 text-sm mb-4">{project.description}</p>
                                            <div className="flex items-center justify-between">
                                                <span className="text-gray-400 text-sm">{project.implementation.timeline}</span>
                                                <div className="text-gray-400">‚ñ∂</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    <Modal />
                </>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<DataAnalysisDashboard />);
    </script>
</body>
</html>
